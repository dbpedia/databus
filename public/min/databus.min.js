var databusApplication=angular.module("databusApplication",["angular-content-editable","dndLists","angular-click-outside"]).controller("HeaderController",["$scope","$http","collectionManager",HeaderController]).factory("collectionManager",["$interval","$http",function(t,e){return new DatabusCollectionManager(e,t,"databus_collections")}]).factory("focus",["$timeout","$window",function(t,e){return function(i){t((function(){var t=e.document.getElementById(i);t&&t.focus()}))}}]).controller("HeaderController",["$scope","$http","collectionManager",HeaderController]).controller("AccountPageController",["$scope","$http","$location",AccountPageController]).controller("FrontPageController",["$scope","$sce","$http",FrontPageController]).controller("ArtifactPageController",["$scope","$http","$sce","collectionManager",ArtifactPageController]).controller("CollectionController",["$scope","$sce","$http","collectionManager",CollectionController]).controller("CollectionsEditorController",["$scope","$timeout","$http","$location","collectionManager",CollectionsEditorController]).controller("GroupPageController",["$scope","$http","$sce","$interval","collectionManager",GroupPageController]).controller("ProfileController",["$scope","$http",ProfileController]).controller("PublishWizardController",["$scope","$http","focus","$q",PublishWizardController]).controller("VersionPageController",["$scope","$http","$sce","collectionManager",VersionPageController]).directive("uploadRanking",(function(){return{restrict:"E",replace:!0,templateUrl:"/website/templates/upload-ranking.html",scope:{data:"=data"}}}));function config(t){t.html5Mode({enabled:!0,requireBase:!1,rewriteLinks:!1})}databusApplication.config(["$locationProvider",config]),databusApplication.component("overrideCheckbox",{templateUrl:"/js/components/override-checkbox/override-checkbox.html",controller:OverrideCheckboxController,bindings:{checkValue:"<",label:"<",id:"<",readonly:"<",isOverride:"<",onChange:"&"}}),databusApplication.component("databusAlert",{templateUrl:"/js/components/databus-alert/databus-alert.html",controller:["$scope","$timeout",DatabusAlertController]}),databusApplication.component("entityCard",{templateUrl:"/js/components/entity-card/entity-card.html",controller:["$sce",EntityCardController],bindings:{label:"<",uri:"<",desc:"<",date:"<",type:"<",imageUrl:"<"}}),databusApplication.component("search",{templateUrl:"/js/components/search/search.html",controller:["$http","$interval","$sce",SearchController],bindings:{searchInput:"=",settings:"<"}}),databusApplication.component("autofillDropdown",{templateUrl:"/js/components/autofill-dropdown/autofill-dropdown.html",controller:["$timeout",AutofillDropdownController],bindings:{input:"=",values:"<",isDisabled:"<",placeholder:"@",onChange:"&"}}),databusApplication.component("databusIcon",{templateUrl:"/js/components/databus-icon/databus-icon.html",controller:DatabusIconController,bindings:{size:"<",shape:"<",onClick:"&",isClickable:"<",color:"<"}}),databusApplication.component("artifactCard",{templateUrl:"/js/components/artifact-card/artifact-card.html",controller:ArtifactCardController,bindings:{artifact:"<"}}),databusApplication.component("typeTag",{templateUrl:"/js/components/type-tag/type-tag.html",controller:TypeTagController,bindings:{type:"<",height:"<",width:"<"}}),databusApplication.component("collectionEditor",{templateUrl:"/js/components/collection-editor/collection-editor.html",controller:["$http","$location","$sce",CollectionEditorController],bindings:{collection:"=",readonly:"<",onPublish:"&",onDelete:"&",loggedIn:"<"}}),databusApplication.component("collectionEditorWidget",{templateUrl:"/js/components/collection-editor-widget/collection-editor-widget.html",controller:["collectionManager","$scope",CollectionEditorWidgetController],bindings:{selection:"<",collection:"="}}),databusApplication.component("collectionHierarchy",{templateUrl:"/js/components/collection-hierarchy/collection-hierarchy.html",controller:["$http","$location","$sce",CollectionHierarchyController],bindings:{collection:"=",readonly:"<",onPublish:"&",onDelete:"&",loggedIn:"<",onChange:"&"}}),databusApplication.component("collectionHierarchyTwo",{templateUrl:"/js/components/collection-hierarchy-two/collection-hierarchy.html",controller:["$http","$location","$sce","$scope","collectionManager",CollectionHierarchyControllerTwo],bindings:{collection:"=",onChange:"&",onAddContent:"&"}}),databusApplication.component("collectionNode",{templateUrl:"/js/components/collection-node/collection-node.html",controller:CollectionNodeController,bindings:{node:"<",readonly:"<",onRemoveNode:"&",onClick:"&",count:"<",isExpandable:"<"}}),databusApplication.component("collectionSearch",{templateUrl:"/js/components/collection-search/collection-search.html",controller:["collectionManager","$http","$interval","$sce",CollectionSearchController],bindings:{collection:"=",targetDatabusUrl:"<",onComponentAdded:"&"}}),databusApplication.component("collectionStatistics",{templateUrl:"/js/components/collection-statistics/collection-statistics.html",controller:["$http","$scope","$location","$sce",CollectionStatisticsController],bindings:{collection:"<"}}),databusApplication.component("collectionStatus",{templateUrl:"/js/components/collection-status/collection-status.html",controller:["$http","$location","$sce",CollectionStatusController],bindings:{hasLocalChanges:"<",isPublished:"<",isDraft:"<"}}),databusApplication.component("databusSearch",{templateUrl:"/js/components/databus-search/databus-search.html",controller:["$http","$interval","$sce",DatabusSearchController],bindings:{filters:"=",input:"="}}),databusApplication.component("editLabel",{templateUrl:"/js/components/edit-label/edit-label.html",controller:["$element",EditLabelController],bindings:{text:"=",singleLine:"<",onBlur:"&",onChange:"&"}}),databusApplication.component("expandableArrow",{templateUrl:"/js/components/expandable-arrow/expandable-arrow.html",controller:ExpandableArrowController,bindings:{expanded:"=",onChange:"&",isReadonly:"<"}}),databusApplication.component("facetsView",{templateUrl:"/js/components/facets-view/facets-view.html",controller:["$http","$scope",FacetsViewController],bindings:{node:"=",readonly:"<",resourceType:"@",onChange:"&",onLoaded:"&"}}),databusApplication.component("facetsViewHorizontal",{templateUrl:"/js/components/facets-view/facets-view-horizontal.html",controller:["$http","$scope",FacetsViewController],bindings:{node:"=",readonly:"<",resourceType:"@",onChange:"&",onLoaded:"&"}}),databusApplication.component("fileBrowser",{templateUrl:"/js/components/file-browser/file-browser.html",controller:["$http","$scope",FileBrowserController],bindings:{resourceUri:"<",resourceType:"@",node:"<",facetSettings:"<",parentFacetSettings:"<",query:"<",fullQuery:"<",config:"<"}}),databusApplication.component("multiselectArtifactDropdown",{templateUrl:"/js/components/multiselect-artifact-dropdown/multiselect-artifact-dropdown.html",controller:["$timeout","$sce",MultiselectArtifactDropdownController],bindings:{data:"<",node:"<",values:"<",isDisabled:"<",icon:"<",onChange:"&"}}),databusApplication.component("multiselectDropdown",{templateUrl:"/js/components/multiselect-dropdown/multiselect-dropdown.html",controller:["$timeout","$sce",MultiselectDropdownController],bindings:{parentInput:"<",input:"=",values:"<",isDisabled:"<",placeholder:"@",onChange:"&"}}),databusApplication.component("tableEditor",{templateUrl:"/js/components/table-editor/table-editor.html",controller:TableEditorController,bindings:{model:"=",onRemoveFile:"&",onAnalyzeFile:"&",analysisProcesses:"<"}}),databusApplication.component("uriBreadcrumbs",{templateUrl:"/js/components/uri-breadcrumbs/uri-breadcrumbs.html",controller:UriBreadcrumbsController,bindings:{uri:"<"}}),databusApplication.component("yasqeText",{templateUrl:"/js/components/yasqe-text/yasqe-text.html",controller:["$scope","$element",YasqeTextController],bindings:{query:"=",readOnly:"<",onChange:"&"}}),databusApplication.component("collectionDataTable",{templateUrl:"/js/components/collection-data-table/collection-data-table.html",controller:["$http","$scope","$location","$sce",CollectionDataTableController],bindings:{collection:"<"}}),databusApplication.directive("selectOnClick",["$window",function(t){return{restrict:"A",link:function(e,i,a){i.on("click",(function(){t.getSelection().toString()||0!=this.readonly||this.setSelectionRange(0,this.value.length)}))}}}]),databusApplication.directive("focusMe",["$timeout","$parse",function(t,e){return{link:function(i,a,o){var n=e(o.focusMe);i.$watch(n,(function(e){!0===e&&t((function(){a[0].focus()}))}))}}}]),databusApplication.directive("eventFocus",(function(t){return function(e,i,a){i.on(a.eventFocus,(function(){t(a.eventFocusId)})),e.$on("$destroy",(function(){i.off(a.eventFocus)}))}})),databusApplication.directive("uploaderRanking",(function(){return{restrict:"E",replace:!0,template:'<div><table class="table is-size-6 is-fullwidth"><thead><tr><th>User</th><th>Uploads</th><th>Derived Data</th></tr></thead><tbody><tr ng-repeat="row in data"><td><a href="{{ row.accountUri }}">{{ row.account }}</a></td><td>{{ row.numUploads }}</td><td>{{ row.uploadSize }}</td></tr></tbody></table></div>',scope:{data:"=data"}}})),databusApplication.directive("groupsTable",(function(){return{restrict:"E",replace:!0,template:'<div><table class="table is-size-6 is-fullwidth"><thead><tr><th>Group Id</th><th># Artifacts</th></tr></thead><tbody><tr ng-repeat="row in data"><td><a href="{{ row.uri }}">{{ row.label }}</a></td><td>{{ row.artifactCount }}</td></tr></tbody></table></div>',scope:{data:"=data"}}})),databusApplication.directive("activityChart",(function(){return{restrict:"E",replace:!0,template:'<svg class="chart"></svg>',scope:{data:"=data",height:"=height"},link:function(t,e,i){var a=t.height;for(d in t.data)t.data[d].date=new Date(t.data[d].date);var o=d3.select(e[0]).attr("id","graph").attr("width","107%").attr("height",a),n=20,r=50,s=o.node().getBoundingClientRect().width-r-50,l=a-n-60,c=o.append("g").attr("transform","translate("+r+","+n+")"),u=d3.scaleTime().rangeRound([0,s]),p=d3.scaleLinear().rangeRound([l,0]),h=d3.line().x((function(t){return u(t.date)})).y((function(t){return p(t.value)}));u.domain(d3.extent(t.data,(function(t){return t.date}))),p.domain(d3.extent(t.data,(function(t){return t.value}))),c.append("g").attr("transform","translate(0,"+l+")").call(d3.axisBottom(u)).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),c.append("g").call(d3.axisLeft(p)).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y",6).attr("dy","1em").attr("font-size","1.1em").attr("text-anchor","end").text("Uploaded Data (GByte)");c.append("path").datum(t.data).attr("fill","none").attr("stroke","steelblue").attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("stroke-width",2).attr("d",h)}}})),databusApplication.directive("onFinishRender",["$timeout","$parse",function(t,e){return{restrict:"A",link:function(i,a,o){!0===i.$last&&t((function(){i.$emit("ngRepeatFinished"),o.onFinishRender&&e(o.onFinishRender)(i)}))}}}]);class DatabusCollectionManager{constructor(t,e,i){this.storageKeyPrefix=`${i}_${encodeURI(DATABUS_RESOURCE_BASE_URL)}`,this.sessionInfo=JSON.parse(window.sessionStorage.getItem(`${this.storageKeyPrefix}_session`)),null==this.sessionInfo&&(this.sessionInfo={}),this.http=t,this.interval=e}get accountName(){return null!=this.sessionInfo?this.sessionInfo.accountName:void 0}async tryInitialize(t,e){if(this.sessionInfo.accountName=t,window.sessionStorage.setItem(`${this.storageKeyPrefix}_session`,JSON.stringify(this.sessionInfo)),this.storageKey=`${this.storageKeyPrefix}__${t}`,this.remote=this.loadCollectionsFromStorage(!1),this.local=this.loadCollectionsFromStorage(!0),this.findActive(),e)try{var i=await this.http.get(`/app/account/collections?account=${t}`);this.initialize(i.data)}catch(t){console.log("Failed to initialze collection manager."),console.log(t)}var a=this;this.interval((function(){var t=window.localStorage.getItem(`${a.storageKey}_hash`);t!=a.currentHash&&(a.local=JSON.parse(window.localStorage.getItem(a.storageKey)),a.currentHash=t,null!=a.onCollectionChangedInDifferentTab&&a.onCollectionChangedInDifferentTab())}),300)}initialize(t){this.remote={};let e={};for(let i in this.local){if(!i.startsWith("___")){delete this.local[i];continue}if(i!==this.local[i].uuid){delete this.local[i];continue}let a=this.local[i];if(void 0!==a.uri&&void 0!==t){let o=a.uri;void 0===t[o]?(delete this.local[i].uri,delete this.local[i].issued,delete this.local[i].created):(e[o]=!0,this.remote[i]=t[o],this.local[i].publisher=t[o].publisher,this.local[i].issued=t[o].issued,this.local[i].created=t[o].created,this.local[i].files=t[o].files)}}for(let i in t)if(void 0===e[i]){let e=DatabusCollectionUtils.uuidv4();t[i].uuid=e,this.local[e]=DatabusCollectionUtils.createCleanCopy(t[i]),this.remote[e]=DatabusCollectionUtils.createCleanCopy(t[i])}for(let t in this.local)this.local[t]=new DatabusCollectionWrapper(this.local[t]),this.local[t].content instanceof Object||(this.local[t].content={groups:[],customQueries:[]});null==this.activeCollection&&this.selectFirstOrCreate(),QueryNode.assignParents(this.activeCollection.content.root),this.saveLocally(),void 0!==this.initialized&&this.initialized()}findActive(){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized1.";null==this.activeCollection&&this.selectFirstOrCreate()}get isInitialized(){return null!=this.accountName}loadCollectionsFromStorage(t=!0){let e;e=t?JSON.parse(window.localStorage.getItem(this.storageKey)):JSON.parse(window.sessionStorage.getItem(this.storageKey)),null==e&&(e={});for(let t in e)void 0===t||"undefined"===t?delete e[t]:e[t]=new DatabusCollectionWrapper(e[t]);return e}selectFirstOrCreate(){for(let t in this.local){this.setActive(t);break}null==this.activeCollection&&this.createNew("Unnamed Collection","",(function(t){}))}setActive(t){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized1.";this.convertCollectionContentToTree(t);let e=this.local[t];QueryNode.assignParents(e.content.root),this.sessionInfo.activeCollectionIdentifier=t,window.sessionStorage.setItem(`${this.storageKeyPrefix}_session`,JSON.stringify(this.sessionInfo))}get activeCollectionIdentifier(){return null!=this.sessionInfo?this.sessionInfo.activeCollectionIdentifier:null}get activeCollection(){return null==this.activeCollectionIdentifier||null==this.local?null:this.local[this.activeCollectionIdentifier]}convertCollectionContentToTree(t){let e=this.local[t];if(void 0===e.content.root)for(var i in e.content.root=new QueryNode(null,null),e.content.groups){var a=e.content.groups[i],o=new QueryNode(a.uri,"dataid:group");for(var n in a.settings){var r=a.settings[n];"SYSTEM_LATEST_ARTIFACT_VERSION"!==r.value&&"SYSTEM_LATEST_GROUP_VERSION"!==r.value||(r.value="$latest"),o.setFacet(r.facet,r.value,r.checked)}for(var s in e.content.root.addChild(o),a.artifacts){var l=a.artifacts[s],c=new QueryNode(l.uri,"dataid:artifact");o.addChild(c)}}}createSnapshot(t){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let e=DatabusCollectionWrapper.createNew();e.content=DatabusCollectionUtils.createCleanCopy(t.content);let i=e.content.root;for(var a in i.childNodes){var o=i.childNodes[a];for(var n in o.facetSettings)"$latest"===o.facetSettings[n][0].value&&this.http.get("/app/utils/facets",{params:{uri:s.uri,type:"group"}}).then((function(t){let e=t.data["http://purl.org/dc/terms/hasVersion"].values.reduce((function(t,e){return t>e?t:e}));s.facetSettings[n][0].value=e}));for(var r in o.childNodes){var s=o.childNodes[r];for(var n in s.facetSettings)"$latest"===s.facetSettings[n][0].value&&this.http.get("/app/utils/facets",{params:{uri:s.uri,type:"artifact"}}).then((function(t){let e=t.data["http://purl.org/dc/terms/hasVersion"].values.reduce((function(t,e){return t>e?t:e}));s.facetSettings[n][0].value=e}))}}return e.label=`Snapshot of ${t.label}`,e.description=t.description,this.local[e.uuid]=new DatabusCollectionWrapper(e),this.saveLocally(),this.setActive(e.uuid),e}saveLocally(){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";null!=this.activeCollection&&(this.activeCollection.hasLocalChanges=this.hasLocalChanges(this.activeCollection));var t=DatabusCollectionUtils.cyrb53Hash(DatabusCollectionUtils.serialize(this.local));this.currentHash=t,window.localStorage.setItem(`${this.storageKey}_hash`,t);try{window.localStorage.setItem(this.storageKey,DatabusCollectionUtils.serialize(this.local)),window.sessionStorage.setItem(this.storageKey,DatabusCollectionUtils.serialize(this.remote))}catch(t){console.log(t)}}hasLocalChanges(t){if(void 0===this.remote[t.uuid])return!0;let e=this.remote[t.uuid],i=DatabusCollectionUtils.serialize(e.content),a=DatabusCollectionUtils.serialize(t.content);return t.label!==e.label||t.description!==e.description||a!==i}discardLocalChanges(t){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let e=this.activeCollection.uuid;if(void 0===this.remote[e])return;let i=this.activeCollection.uri;null!=i&&(null!=t&&null!=t[i]&&(this.remote[e]=DatabusCollectionUtils.createCleanCopy(t[i])),this.local[e].label=this.remote[e].label,this.local[e].description=this.remote[e].description,this.local[e].content=DatabusCollectionUtils.createCleanCopy(this.remote[e].content),this.local[e].hasLocalChanges=this.hasLocalChanges(this.local[e]))}addElement(t){this.current.addElement(t),this.saveLocally(),null!=this.onActiveCollectionChanged&&this.onActiveCollectionChanged(this.current)}removeElement(t){this.current.removeElement(t),this.saveLocally(),null!=this.onActiveCollectionChanged&&this.onActiveCollectionChanged(this.current)}createNew(t,e,i){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";if(void 0===t||!/^\w+[\w\s]*$/.test(t))return void i(!1);let a=DatabusCollectionWrapper.createNew(t,e,DATABUS_RESOURCE_BASE_URL);this.local[a.uuid]=new DatabusCollectionWrapper(a),this.setActive(a.uuid),this.saveLocally(),i(!0)}createDraft(t){if(!this.isInitialized)return;let e=DatabusCollectionWrapper.createNew("","");this.local[e.uuid]=new DatabusCollectionWrapper(e),this.setActive(e.uuid),this.saveLocally(),t(DatabusResponse.COLLECTION_DRAFT_CREATED)}createCopy(t){if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let e=DatabusCollectionWrapper.createNew();return e.content=DatabusCollectionUtils.createCleanCopy(t.content),e.label=`Copy of ${t.label}`,e.abstract=t.abstract,e.description=t.description,this.local[e.uuid]=new DatabusCollectionWrapper(e),this.saveLocally(),this.setActive(e.uuid),e}deleteLocally(t){delete this.local[this.activeCollection.uuid],this.selectFirstOrCreate(),this.saveLocally(),t({code:909})}getCollectionByUri(t){if(null==t)return null;for(let e in this.local)if(t===this.local[e].uri)return this.local[e];return null}getFirstCollection(){return 0===this.local.length?null:this.local[0]}async changeCollection(t,e){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";this.saveLocally();var i=this.activeCollection.uuid,a=`${DATABUS_RESOURCE_BASE_URL}/${t}#this`,o=encodeURIComponent(DatabusCollectionUtils.serialize(this.activeCollection.content,["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published","uuid"]));let s={"@context":JSONLD_CONTEXT,"@graph":[{"@id":e,"@type":"dataid:Collection",publisher:a,title:this.activeCollection.label,abstract:this.activeCollection.abstract,description:this.activeCollection.description,"dataid:content":o}]};null!=this.activeCollection.issued?s["@graph"][0].issued=this.activeCollection.issued:s["@graph"][0].issued=Date.now().toString();var n=null;try{n=await this.http.put(e,s)}catch(t){throw console.log(t),{code:t.data.code}}var r=n.data.data[0];if(this.activeCollection.uuid!=i)throw{code:DatabusResponse.COLLECTION_INVALID_ARGUMENT};return this.remote[i]=JSON.parse(DatabusCollectionUtils.serialize(this.activeCollection)),this.local[i].uri=r["@id"],this.local[i].hasLocalChanges=this.hasLocalChanges(this.local[i]),this.saveLocally(),n.data}catch(t){throw console.log(t),{code:void 0!==t.data&&void 0!==t.data.code?t.data.code:DatabusResponse.COLLECTION_UPDATE_ERROR}}}async updateCollection(t,e){if(null!=this.activeCollection.uri)return await this.changeCollection(t,this.activeCollection.uri);var i=`${DATABUS_RESOURCE_BASE_URL}/${t}/collections/${e}`;for(var a in this.local)if(this.local[a].uri==i)throw"A collection with the specifed URI already exists.";return await this.changeCollection(t,i)}async unHideCollection(t,e){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";var i=`${DATABUS_RESOURCE_BASE_URL}/${t}/collections/${e}`,a=await this.changeCollection(t,i,null,!0),o=this.getCollectionByUri(a.data[0]["@id"]);return this.remote[o.uuid].issued=a.data[0]["http://purl.org/dc/terms/issued"][0]["@value"],this.local[o.uuid].issued=a.data[0]["http://purl.org/dc/terms/issued"][0]["@value"],this.saveLocally(),{code:a.code}}catch(t){throw{code:void 0!==t.data&&void 0!==t.data.code?t.data.code:DatabusResponse.COLLECTION_UPDATE_ERROR}}}async hideCollection(t,e){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";var i=`${DATABUS_RESOURCE_BASE_URL}/${t}/collections/${e}`,a=await this.changeCollection(t,i),o=this.getCollectionByUri(a.data[0]["@id"]);return delete this.remote[o.uuid].issued,delete this.local[o.uuid].issued,this.saveLocally(),{code:a.code}}catch(t){throw{code:void 0!==t.data&&void 0!==t.data.code?t.data.code:DatabusResponse.COLLECTION_UPDATE_ERROR}}}async fetchCollection(t){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";var e={method:"GET",url:t,headers:{Accept:"application/json"}},i=await this.http(e),a=getCollectionByUri(t);this.local[a.uuid].content=i.data.content,this.local[a.uuid].created=i.data.created,this.local[a.uuid].issued=i.data.issued,this.local[a.uuid].label=i.data.label,this.local[a.uuid].description=i.data.description,this.local[a.uuid].files=i.data.files}catch(t){return console.log(t),t.data}}async deleteCollection(t,e){try{if(!this.isInitialized)throw"Databus-Collection-Manager is not initialized.";let a=this.activeCollection.uuid;if(this.activeCollection.isDraft)return delete this.local[a],this.saveLocally(),{code:DatabusResponse.COLLECTION_DELETED};let o=this.activeCollection.uri;DatabusCollectionUtils.uriToName(o);var i=`/${t}/collections/${e}`;let n=await this.http.delete(i);return delete this.remote[a],delete this.local[a],n.data}catch(t){return console.log(t),t.data}}}class DatabusCollectionUtils{static checkCollectionForm(t,e){var i=!1;return this.checkLabel(e.label,1,200)?t.label.error=null:(i=!0,null==e.label||""==e.label?t.label.error=DatabusResponse.COLLECTION_MISSING_LABEL:t.label.error=DatabusResponse.COLLECTION_INVALID_LABEL),this.checkText(e.description,50,0)?t.description.error=null:(i=!0,null==e.description||""==e.description?t.description.error=DatabusResponse.COLLECTION_MISSING_DESCRIPTION:t.description.error=DatabusResponse.COLLECTION_INVALID_DESCRIPTION),!i}static checkIdentifier(t){return this.checkField(t,/^[a-z0-9_-]+$/,1,50)}static checkText(t,e,i){return this.checkField(t,/^[\x00-\xFF\n]*$/,e,i)}static checkLabel(t,e,i){return this.checkField(t,/^[A-Za-z0-9\s_()\.\,\-]*$/,e,i)}static checkField(t,e,i,a){return null!=t&&(!(a>0&&t.length>a)&&(!(t.length<i)&&e.test(t)))}static checkCollectionTexts(t){return null==t.label||""==t.label?DatabusResponse.COLLECTION_MISSING_LABEL:!/^[\x00-\x7F]*$/.test(t.label)||t.label.length>200?DatabusResponse.COLLECTION_INVALID_LABEL:null==t.description||""==t.description?DatabusResponse.COLLECTION_MISSING_DESCRIPTION:!/^[\x00-\x7F\n]*$/.test(t.description)||description.description.length<50?DatabusResponse.COLLECTION_INVALID_DESCRIPTION:0}static uuidv4(){return"___xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}static uriToName(t){if(null==t)return null;var e=t.substr(t.lastIndexOf("/")+1);return e=e.substr(e.lastIndexOf("#")+1)}static navigateUp(t){return t.substr(0,t.lastIndexOf("/"))}static copyStringToClipboard(t){var e=document.createElement("textarea");e.value=t,e.setAttribute("readonly",""),e.style={position:"absolute",left:"-9999px"},document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}static createQueryString(t){return new DatabusCollectionWrapper(t).createQuery()}static reduceBinding(t){for(var e in t)t[e]=t[e].value;return t}static async getCollectionStatistics(t,e){var i=QueryBuilder.build({node:e.content.root,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL,template:QueryTemplates.COLLECTION_STATISTICS_TEMPLATE});if(null==i)return null;var a={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(i),headers:{"Content-type":"application/x-www-form-urlencoded"}},o=(await t(a)).data.results.bindings;if(0===(o=o.filter((function(t){return null!=t.file}))).length)return null;let n={fileCount:o.length,licenses:[],files:[],size:0};for(let t in o){let e=DatabusCollectionUtils.reduceBinding(o[t]);n.size+=parseInt(e.size),n.licenses.push(e.license),n.files.push(e)}return n.licenses=n.licenses.filter((function(t,e,i){return i.indexOf(t)===e})),n}static async getCollectionFiles(t,e){if(!e.hasContent)return[];let i=QueryBuilder.build({node:e.content.root,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL,template:QueryTemplates.COLLECTION_FILES_TEMPLATE});var a={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(i),headers:{"Content-type":"application/x-www-form-urlencoded"}},o=(await t(a)).data.results.bindings;if(0===o.length)return null;let n=[];for(let t in o){let e=DatabusCollectionUtils.reduceBinding(o[t]);n.push(e)}return n}static async getCollectionFileURLs(t,e){let i=QueryBuilder.build({node:e.content.root,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL,template:QueryTemplates.DEFAULT_FILE_TEMPLATE});var a={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(i),headers:{"Content-type":"application/x-www-form-urlencoded"}},o=(await t(a)).data.results.bindings;if(0===o.length)return null;let n="";for(let t in o){let e=DatabusCollectionUtils.reduceBinding(o[t]);console.log(e),n+=e.file+"\n"}return n}static serialize(t,e){return null==e&&(e=["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published"]),JSON.stringify(t,(function(t,i){if(!e.includes(t))return i}))}static cyrb53Hash(t,e=0){let i=3735928559^e,a=1103547991^e;for(let e,o=0;o<t.length;o++)e=t.charCodeAt(o),i=Math.imul(i^e,2654435761),a=Math.imul(a^e,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),a=Math.imul(a^a>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&a)+(i>>>0)}static createCleanCopy(t){return JSON.parse(DatabusCollectionUtils.serialize(t))}static exportToJsonFile(t){let e=DatabusCollectionUtils.serialize(t,["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published","uuid"]),i="data:application/json;charset=utf-8,"+encodeURIComponent(e),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download","data.json"),a.click()}}"object"==typeof module&&module&&module.exports&&(module.exports=DatabusCollectionUtils);class DatabusCollectionWrapper{constructor(t){Object.assign(this,t),this.eventListeners={}}addEventListener(t,e){null==this.eventListeners[t]&&(this.eventListeners[t]=[]),this.eventListeners[t].push(e)}isPublisher(t){return null!=this.uri&&this.uri.startsWith("https://databus.dbpedia.org/"+t)}get isPublished(){return null!=this.issued}get displayLabelHtml(){var t="";return this.isDraft&&(t+='<span style="color: #8a8cb3; margin-right:4px">DRAFT:</span>'),t+=null!=this.label&&this.label.length>0?this.label:"Untitled Collection"}get isDraft(){return void 0===this.uri}get hasContent(){if(0==this.content.root.childNodes.length)return!1;for(var t of this.content.root.childNodes)if(t.childNodes.length>0)return!0;return!1}fireEvent(t){if(null!=this.eventListeners[t])for(var e in this.eventListeners[t]){(0,this.eventListeners[t][e])()}}static createNew(t,e,i){var a={};return a.uuid=DatabusCollectionUtils.uuidv4(),a.label=t,a.description=e,a.abstract=e,a.content={},a.content.root=new QueryNode(null,null),a.content.root.addChild(new QueryNode(i,null)),a}createQuery(){return null==this.content.root?null:QueryBuilder.build({template:QueryTemplates.DEFAULT_FILE_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL,node:this.content.root})}downloadAsJson(){var t="data:text/json;charset=utf-8,"+encodeURIComponent(angular.toJson(this)),e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("download",this.label+".json"),document.body.appendChild(e),e.click(),e.remove()}removeCustomQueryNode(t){this.content.customQueries=this.content.customQueries.filter((function(e){return t.guid!=e.guid}))}removeNodeByUri(t){QueryNode.removeChildByUri(this.content.root,t)}removeGroupNode(t){this.content.groups=this.content.groups.filter((function(e){return t.uri!=e.uri}))}addCustomQueryNode(t,e){this.content.customQueries.push({guid:DatabusCollectionUtils.uuidv4(),label:t,query:e})}hasGroup(t){return null!=this.findGroup(t)}hasArtifact(t){var e=DatabusCollectionUtils.navigateUp(t),i=this.findGroup(e);return null!=i&&null!=this.findArtifact(i,t)}addGroupNode(t,e){var i=this.findGroup(t);if(null==i){var a=DatabusCollectionUtils.navigateUp(t),o=DatabusCollectionUtils.uriToName(t),n=DatabusCollectionUtils.uriToName(a);(i={}).uri=t,i.artifacts=[],i.label=n+" Â» "+o,i.settings=e,i.expanded=!0,this.content.groups.push(i),this.fireEvent("onGroupAdded")}return i}addArtifactNode(t,e,i){var a=DatabusCollectionUtils.navigateUp(t),o=this.addGroupNode(a,[{facet:"http://purl.org/dc/terms/hasVersion",value:"SYSTEM_LATEST_ARTIFACT_VERSION",checked:!0}]),n=this.findArtifact(o,t);null==n&&((n={}).uri=t,n.label=e,n.settings=i,o.artifacts.push(n),this.fireEvent("onArtifactAdded"))}findGroup(t){for(var e in this.content.groups){var i=this.content.groups[e];if(i.uri==t)return i}return null}findArtifact(t,e){for(var i in t.artifacts){var a=t.artifacts[i];if(a.uri==e)return a}return null}}function ArtifactCardController(){this.$onInit=function(){}}function AutofillDropdownController(t){var e=this;e.$onInit=function(){e.displayValues=[]},e.showAll=function(){e.showDrop=!0,e.displayValues=e.values},e.handleKey=function(t){9!==t.which&&13!==t.which||(e.showDrop=!1,e.displayValues.length>0&&e.input!=e.displayValues[0]&&(t.preventDefault(),e.input=e.displayValues[0],e.change()))},e.hideDropDelayed=function(){t((function(){e.showDrop=!1}),120)},e.autoComplete=function(){if(e.showDrop=!0,""!=e.input&&null!=e.input){for(var t of(e.displayValues=[],e.values))t.includes(e.input)&&t!=e.input&&e.displayValues.push(t);0==e.displayValues.length&&(e.showDrop=!1)}else e.displayValues=e.values},e.change=function(){e.autoComplete(),t((function(){e.onChange()}),50)}}function CollectionDataTableController(t,e,i,a){var o=this;o.$http=t,o.$onInit=function(){o.isLoading=!0,DatabusCollectionUtils.getCollectionFiles(o.$http,o.collection).then((function(t){o.files=t,o.files=o.files.filter((function(t){return null!=t.files})),o.isLoading=!1,e.$apply()}),(function(t){o.statistics=null,o.isLoading=!1})),null!=o.files&&(o.groupedFiles=o.groupBy(o.files,"dataset"))},o.getRowspan=function(t){var e=2*t.downloads.length;return t.downloads[t.downloads.length-1].expanded||e--,e},o.groupBy=function(t,e){var i={};for(var a in t){var o=t[a],n=o[e];null==i[n]&&(i[n]={},i[n].value=n,i[n].title=o.title,i[n].uri=o.dataset,i[n].version=o.version,i[n].downloads=[],i[n].licenses=[]),i[n].downloads.push(o)}return i},o.calculateRowSpan=function(t){var e=0;for(var i in t.downloads)e+=t.downloads[i].expanded?2:1;return e},o.createRelativeUri=function(t){return new URL(t).pathname},o.$doCheck=function(){null!=o.files&&o.previousFileCount!=o.files.length&&(o.previousFileCount=o.files.length,o.groupedFiles=o.groupBy(o.files,"dataset"))},o.formatUploadSize=function(t){return t<1024?t+" B":t<1048576?Math.round(t/1024)+" KB":t<1073741824?Math.round(10*t/1048576)/10+" MB":Math.round(100*t/1073741824)/100+" GB"}}function CollectionEditorWidgetController(t,e){var i=this;i.$scope=e,i.collectionManager=t,i.$onInit=function(){setTimeout((function(){$(".dropdown-item").click((function(t){var e=$(this).closest(".dropdown");$(e).removeClass("is-active"),t.stopPropagation()})),$("body").click((function(){$(".dropdown").removeClass("is-active")})),$(".dropdown").click((function(t){$(".dropdown").removeClass("is-active"),$(this).addClass("is-active"),t.stopPropagation()}))}),500)},i.goToEditor=function(){window.location.href="/app/collection-editor"},i.addSelectionToCollection=function(t){var e=i.selection;i.collectionManager.setActive(t);var a=i.collectionManager.activeCollection,o=QueryNode.findChildByUri(a.content.root,DATABUS_RESOURCE_BASE_URL);null==o&&(o=new QueryNode(DATABUS_RESOURCE_BASE_URL,null),a.content.root.childNodes.push(o)),QueryNode.mergeAddChild(o,e),i.collectionManager.activeCollection.hasLocalChanges=i.collectionManager.hasLocalChanges(i.collectionManager.activeCollection),i.collectionManager.saveLocally()}}function CollectionEditorController(t,e,i){var a=this;a.activeTab=0,a.viewMode=-1,a.$http=t,a.$onInit=function(){a.viewMode=-1,null!=a.collection&&a.updateViewModel()},a.$doCheck=function(){null!=a.collection?a.previousCollectionId!=a.collection.uuid&&(a.previousCollectionId=a.collection.uuid,a.activeNode=null,a.viewMode=-1,a.updateViewModel()):a.previousCollectionId=null},a.updateViewModel=function(){for(var t in a.collectionWrapper=new DatabusCollectionWrapper(a.collection),a.collection.files=a.groupBy(a.collection.files,"dataset"),a.rootNode={label:a.collection.label,expanded:!0},a.generatedNode={label:"Generated Queries",expanded:a.collection.content.groups.length>0},a.customNode={label:"Custom Queries",expanded:a.collection.content.customQueries.length>0},a.collection.content.groups)a.collection.content.groups[t].expanded=!0},a.groupBy=function(t,e){var i={};for(var a in t){var o=t[a],n=o[e];null==i[n]&&(i[n]={},i[n].value=n,i[n].label=o.label,i[n].version=o.version,i[n].downloads=[],i[n].licenses=[]),i[n].downloads.push(o)}return i},a.sortBy=function(t){a.sortProperty==t&&(a.sortReverse=!a.sortReverse),a.sortProperty=t},a.formatUploadSize=function(t){return Math.round(100*t)/100},a.toHTML=function(t){return i.trustAsHtml(t)},a.showFiles=function(){a.activeTab=0,a.isStatisticsLoading=!1},a.showHierarchy=function(){a.activeTab=1,a.isStatisticsLoading=!1},a.showStatistics=function(){a.activeTab=2,a.isStatisticsLoading=!0,a.loadStatisticsError=null,a.$http.get("/system/api/collection-statistics",{params:{uri:a.collection.uri}}).then((function(t){a.isStatisticsLoading=!1,a.statistics=t.data,null!=a.statistics&&""!=a.statistics?a.statistics.licenses=a.statistics.licenses.split(","):a.loadStatisticsError="Failed to load collection statistics. Make sure the collection is published and try again."}))},a.onComponentAdded=function(){a.generatedNode.expanded=!0},a.customExpanded=function(){return a.customNode.expanded&&a.collection.content.customQueries.length>0},a.generatedExpanded=function(){return a.generatedNode.expanded&&a.collection.content.groups.length>0},a.publishCollection=function(){a.onPublish()},a.delete=function(){a.onDelete()},a.goToResource=function(t){window.location=t.uri},a.showCollectionSearch=function(){a.open=!1,a.viewMode=0,a.activeNode=a.rootNode,e.hash("search")},a.showGroupNode=function(t){a.open=!0,a.viewMode=3,a.activeNode=t},a.showArtifactNode=function(t,e){a.open=!0,a.viewMode=1,a.activeNode=t,a.parentNode=e},a.addCustomNode=function(){a.collectionWrapper.addCustomQueryNode("Custom Query","SELECT * WHERE { ?s ?p ?o. }"),a.customNode.expanded=!0},a.removeArtifactNode=function(t,e){},a.showCustomQueryNode=function(t){a.open=!0,a.viewMode=2,a.activeNode=t}}function CollectionHierarchyControllerTwo(t,e,i,a,o){var n=this;n.viewMode=-1,n.$http=t,n.$scope=a,n.facets=new DatabusFacetsCache(t),o.onCollectionChangedInDifferentTab=function(){n.previousCollectionId=null},n.defaultQuery="PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dcv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct:    <http://purl.org/dc/terms/>\nPREFIX dcat:   <http://www.w3.org/ns/dcat#>\nPREFIX rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>\nSELECT ?file WHERE {\n  # Replace this with your custom query:\n  ?file <matches> <condition> .\n} LIMIT 0";const r="dataid:artifact",s="dataid:group",l="$latest";n.$onInit=function(){n.viewMode=-1,n.collection},n.onAddContentClicked=function(t){n.onAddContent({source:t.uri}),n.onChange(),n.updateViewModel()},n.onAddCustomQueryClicked=function(t){QueryNode.createFrom(t).addChild(new QueryNode(DatabusUtils.uuidv4(),null)),n.onChange()},n.toggleCollapsed=function(t,e){e.collapsed=!e.collapsed,e.collapsed||n.query(t)},n.isDatabus=async function(t){var e={method:"GET",url:t,headers:{Accept:"application/rdf+turtle"}},i=await n.$http(e),a=await DatabusUtils.parseDatabusManifest(i.data),o=new URL(t);return null!=a&&a.uri==o.origin},n.getDatabusUri=async function(t){var e=new URL(t),i=e.pathname.split("/"),a=e.origin;if(await n.isDatabus(a))return a;for(var o=0;i.length;o++){if(a+=`/${i[o]}`,await n.isDatabus(a))return a}},n.onAddResource=async function(t){if(t.endsWith("/")&&(t=t.substr(0,t.length-1)),null==QueryNode.findChildByUri(n.root,t)){var e=await n.getDatabusUri(t),i=DatabusUtils.getResourcePathLength(e),a=DatabusUtils.getResourcePathLength(t)-i;if(!(a<0&&a>3||2==a)){if(0==a&&n.addDatabus(t),2==a){n.addDatabus(e);let i=QueryNode.findChildByUri(n.root,e);n.addGroup(i,t)}if(3==a){n.addDatabus(e);let i=QueryNode.findChildByUri(n.root,e),a=DatabusUtils.navigateUp(t);n.addGroup(i,a);let o=QueryNode.findChildByUri(n.root,a);n.addArtifact(o,t)}n.onChange(),n.updateViewModel(),n.$scope.$apply()}}},n.addDatabus=function(t){null==QueryNode.findChildByUri(n.root,t)&&n.root.childNodes.push(new QueryNode(t,null))},n.addGroup=function(t,e){null==QueryNode.findChildByUri(n.root,e)&&t.childNodes.push(new QueryNode(e,s))},n.addArtifact=function(t,e){null==QueryNode.findChildByUri(n.root,e)&&t.childNodes.push(new QueryNode(e,r))},n.addToCollection=function(t,e,i){if(n.isInCollection(i))QueryNode.removeChildByUri(n.root,i.resource[0].value);else{if("Group"==i.typeName[0].value){let e=new QueryNode(i.resource[0].value,s);t.childNodes.push(e)}if("Artifact"==i.typeName[0].value){var a=i.resource[0].value;let e=DatabusCollectionUtils.navigateUp(a),o=QueryNode.findChildByUri(n.root,e);null==o&&(o=new QueryNode(e,s),t.childNodes.push(o));let l=new QueryNode(a,r);o.addChild(l)}}for(var o of e.searchResults)o.inCollection=n.isInCollection(o);n.onChange(),n.updateViewModel()},n.isLastChild=function(t,e){return null!=t.childNodes&&0!=t.childNodes.length&&t.childNodes[t.childNodes.length-1].uri==e.uri},n.toggleExpand=function(t){t.expanded=!t.expanded,n.onChange()},n.mergeFacets=function(t,e){if(null!=t.facets){for(var i in e)if(null!=t.facets[i])for(var a of e[i].values)t.facets[i].values.includes(a)||t.facets[i].values.push(a);else t.facets[i]=JSON.parse(JSON.stringify(e[i]));t.facetLabels=null}else t.facets=JSON.parse(JSON.stringify(e))},n.getAllFilters=function(t,e){if(null==e){var i=Object.keys(t.facetSettings);return DatabusUtils.uniqueList(i)}i=Object.keys(t.facetSettings).concat(Object.keys(e.facetSettings));return DatabusUtils.uniqueList(i)},n.$doCheck=function(){null!=n.collection?n.previousCollectionId!=n.collection.uuid&&(n.previousCollectionId=n.collection.uuid,n.activeNode=null,n.viewMode=-1,n.updateViewModel()):n.previousCollectionId=null},n.handleKey=function(t,e){9===t.which&&(e.showSearchResults=!1)},n.isInCollection=function(t){let e=t.resource[0].value;return null!=QueryNode.findChildByUri(n.root,e)},n.updateSearchResults=function(t){if(null!=t&&null!=t.searchResults)for(var e of t.searchResults)e.inCollection=n.isInCollection(e)},n.searchNode=function(e,i){var a=new URL(e.uri).origin,o="typeName=Artifact Group",r=void 0;e.property==s&&(o="typeName=Artifact",r=e.uri);var l=`${a}/api/search?${o}&format=JSON_FULL&minRelevance=15&maxResults=50&query=${i.search}`;try{t({method:"GET",url:l}).then((function(t){for(var e of(i.searchResults=[],t.data.docs))(null==r||e.resource[0].value.startsWith(r))&&(e.inCollection=n.isInCollection(e),i.searchResults.push(e))}),(function(t){console.log(t)}))}catch(t){}},n.toggleExpand=function(t){t.expanded=!t.expanded},n.isValidHttpUrl=function(t){return DatabusUtils.isValidHttpUrl(t)},n.updateViewModel=function(){for(var t in n.collectionWrapper=new DatabusCollectionWrapper(n.collection),n.root=n.collection.content.root,QueryNode.assignParents(n.root),n.view={},n.view.groups={},n.view.artifacts={},n.view.sources={},n.root.childNodes){var e=n.root.childNodes[t];for(var i in e.expanded=!0,n.view.sources[e.uri]={},n.view.sources[e.uri].uri=e.uri,n.view.sources[e.uri].addMode="artifact",n.view.sources[e.uri].customQueryLabel="New Custom Query",n.view.sources[e.uri].customQueryInput=n.defaultQuery,e.childNodes){var o=e.childNodes[i];if(o.expanded=!0,n.view.groups[o.uri]={},DatabusUtils.isValidHttpUrl(o.uri))for(var r in n.facets.get(o.uri).then((function(t){delete t.facets["http://dataid.dbpedia.org/ns/core#artifact"],n.view.groups[t.uri].facets=t.facets;var e=n.view.groups[t.uri].facets[DatabusUris.DCT_HAS_VERSION];null==e||e.values.includes(l)||(e.values.unshift(l),a.$apply())})),n.query(o),o.childNodes){var s=o.childNodes[r];n.view.artifacts[s.uri]={},n.view.artifacts[s.uri].expanded=!1,n.view.artifacts[s.uri].collapsed=!0,n.facets.get(s.uri).then((function(t){n.view.artifacts[t.uri].facets=t.facets;var e=n.view.artifacts[t.uri].facets[DatabusUris.DCT_HAS_VERSION];null==e||e.values.includes(l)||(e.values.unshift(l),a.$apply())}))}}}},n.onArtifactDropdownChanged=function(t){n.onChange(),n.query(t)},n.selectAddFilterValue=function(t,e){t.addFilterValueInput=e,t.showValueDrop=!1,n.onAddFilterValueInputChanged(t)},n.selectAddFilterFacet=function(t,e){t.addFilterFacetInput=e,t.showFacetDrop=!1,n.onAddFilterFacetInputChanged(t)},n.onAddFilterValueInputChanged=function(t){for(var e of t.facets[t.addFilterFacet].values)if(t.addFilterValueInput==e)return void(t.addFilterValue=e);t.addFilterValue=null},n.onAddFilterFacetInputChanged=function(t){for(var e in t.facets)if(t.addFilterFacetInput==t.facets[e].label)return void(t.addFilterFacet!=e&&(t.addFilterFacet=e,t.addFilterValue=[]));t.addFilterFacet=null,t.addFilterValue=[]},n.includesValue=function(t,e){if(null==t)return!1;for(var i of t)if(i.value==e)return!0;return!1},n.isLocalDatabusNode=function(t){return t.uri==DATABUS_RESOURCE_BASE_URL},n.addFilter=function(t,e,i,a){if(null!=i){for(var o of(null==t.facetSettings[e]&&(t.facetSettings[e]=[]),i))n.includesValue(t.facetSettings[e],o.value)||t.facetSettings[e].push(o);n.onChange(),n.query(t)}},n.query=function(t){if(null!=t.childNodes&&t.childNodes.length>0)for(var e of(t.files=null,t.childNodes))n.query(e);else{var i=QueryNode.createSubTree(t),a=QueryBuilder.build({node:i,template:QueryTemplates.NODE_FILE_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL});this.querySparql(a).then((function(e){t.files=e,n.$scope.$apply()}))}},n.removeFilter=function(t,e){null!=t.facetSettings[e]&&(delete t.facetSettings[e],n.onChange(),n.query(t))},n.onActiveFilterChanged=function(t){n.onChange(),n.query(t)},n.getFacetLabels=function(t){if(null!=t.facetLabels)return t.facetLabels;var e=[];for(var i in t.facets)e.push(t.facets[i].label);return t.facetLabels=e,e},n.sortBy=function(t){n.sortProperty==t&&(n.sortReverse=!n.sortReverse),n.sortProperty=t},n.formatFileSize=function(t){return DatabusUtils.formatFileSize(t)},n.toHTML=function(t){return i.trustAsHtml(t)},n.onComponentAdded=function(){},n.customExpanded=function(){return n.customNode.expanded&&n.collection.content.customQueries.length>0},n.generatedExpanded=function(){return n.generatedNode.expanded&&n.collection.content.groups.length>0},n.publishCollection=function(){n.onPublish()},n.delete=function(){n.onDelete()},n.goToResource=function(t){window.location=t.uri},n.formatGroupPrefix=function(t){return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(t))},n.formatArtifactPrefix=function(t){var e=DatabusCollectionUtils.navigateUp(t),i=DatabusCollectionUtils.uriToName(e);return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(e))+"/"+i},n.uriToName=function(t){return DatabusCollectionUtils.uriToName(t)},n.objSize=function(t){return DatabusUtils.objSize(t)},n.showCollectionSearch=function(){n.open=!1,n.viewMode=0,n.activeNode=n.rootNode,e.hash("search")},n.showGroupNode=function(t){n.open=!0,n.viewMode=3,n.activeNode=QueryNode.createFrom(t),this.updateQuery()},n.showArtifactNode=function(t,e){n.open=!0,n.viewMode=1,n.activeNode=QueryNode.createFrom(t),this.updateQuery()},n.querySparql=async function(t){try{var e={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(t),headers:{"Content-type":"application/x-www-form-urlencoded"}},i=(await n.$http(e)).data.results.bindings;for(var a in i)n.reduceBinding(i[a]);return i}catch(t){console.log(t)}},n.reduceBinding=function(t){for(var e in t)t[e]=t[e].value;return t},n.updateQuery=function(){var t=QueryNode.createSubTree(n.activeNode);n.activeFileQuery=QueryBuilder.build({node:t,template:QueryTemplates.DEFAULT_FILE_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL}),n.activeFullQuery=QueryBuilder.build({node:t,template:QueryTemplates.NODE_FILE_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL})},n.onActiveNodeChanged=function(){this.updateQuery(),n.onChange()},n.addCustomNode=function(t,e,i,a){var o=new QueryNode(e,a);t.childNodes.push(o),n.updateViewModel(),n.onChange()},n.removeNode=function(t){var e=t.parent;n.collectionWrapper.removeNodeByUri(t.uri),n.query(e),n.onChange()},n.showCustomQueryNode=function(t){n.open=!0,n.viewMode=2,n.activeNode=t},n.list=function(t){return t.map((function(t){return t.value})).join(", ")}}function CollectionHierarchyController(t,e,i){var a=this;a.viewMode=-1,a.$http=t,a.artifactTableConfig={},a.artifactTableConfig.columns=[],a.artifactTableConfig.columns.push({field:"version",label:"Version",width:"25%"}),a.artifactTableConfig.columns.push({field:"variant",label:"Variant",width:"25%"}),a.artifactTableConfig.columns.push({field:"format",label:"Format",width:"10%"}),a.artifactTableConfig.columns.push({field:"compression",label:"Compression",width:"15%"}),a.groupTableConfig={},a.groupTableConfig.columns=[],a.groupTableConfig.columns.push({field:"artifact",label:"Artifact",width:"35%",uriToName:!0}),a.groupTableConfig.columns.push({field:"version",label:"Version",width:"17%"}),a.groupTableConfig.columns.push({field:"variant",label:"Variant",width:"17%"}),a.groupTableConfig.columns.push({field:"format",label:"Format",width:"8%"}),a.$onInit=function(){a.viewMode=-1,a.queryBuilder=new QueryBuilder,null!=a.collection&&a.updateViewModel()},a.$doCheck=function(){null!=a.collection?a.previousCollectionId!=a.collection.uuid&&(a.previousCollectionId=a.collection.uuid,a.activeNode=null,a.viewMode=-1,a.updateViewModel()):a.previousCollectionId=null},a.updateViewModel=function(){for(var t in a.collectionWrapper=new DatabusCollectionWrapper(a.collection),a.rootNode={label:a.collection.label,expanded:!0},a.generatedNode={label:"Add Groups and Artifacts by Search",expanded:a.collection.content.groups.length>0},a.customNode={label:"Custom Queries",expanded:a.collection.content.customQueries.length>0},a.collection.content.root.childNodes)a.collection.content.root.childNodes[t].expanded=!0},a.sortBy=function(t){a.sortProperty==t&&(a.sortReverse=!a.sortReverse),a.sortProperty=t},a.formatUploadSize=function(t){return Math.round(100*t)/100},a.toHTML=function(t){return i.trustAsHtml(t)},a.onComponentAdded=function(){a.generatedNode.expanded=!0},a.customExpanded=function(){return a.customNode.expanded&&a.collection.content.customQueries.length>0},a.generatedExpanded=function(){return a.generatedNode.expanded&&a.collection.content.groups.length>0},a.publishCollection=function(){a.onPublish()},a.delete=function(){a.onDelete()},a.goToResource=function(t){window.location=t.uri},a.formatGroupPrefix=function(t){return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(t))},a.formatArtifactPrefix=function(t){var e=DatabusCollectionUtils.navigateUp(t),i=DatabusCollectionUtils.uriToName(e);return DatabusCollectionUtils.uriToName(DatabusCollectionUtils.navigateUp(e))+"/"+i},a.uriToName=function(t){return DatabusCollectionUtils.uriToName(t)},a.showCollectionSearch=function(){a.open=!1,a.viewMode=0,a.activeNode=a.rootNode,e.hash("search")},a.showGroupNode=function(t){a.open=!0,a.viewMode=3,a.activeNode=QueryNode.createFrom(t),this.updateQuery()},a.showArtifactNode=function(t,e){a.open=!0,a.viewMode=1,a.activeNode=QueryNode.createFrom(t),this.updateQuery()},a.updateQuery=function(){var t=QueryNode.createSubTree(a.activeNode);a.activeFileQuery=a.queryBuilder.createFileQuery(t),a.activeFullQuery=a.queryBuilder.createFullQuery(t)},a.onActiveNodeChanged=function(){this.updateQuery(),a.onChange()},a.addCustomNode=function(){a.collectionWrapper.addCustomQueryNode("Custom Query","PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\nPREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dcat:  <http://www.w3.org/ns/dcat#>\n\n# Get all files\nSELECT DISTINCT ?file WHERE {\n  ?dataset dataid:artifact <https://databus.dbpedia.org/dbpedia/publication/strategy> .\n  ?dataset dcat:distribution ?distribution .\n  ?distribution dcat:downloadURL ?file .\n}"),a.customNode.expanded=!0,a.onChange()},a.removeNode=function(t){a.collectionWrapper.removeNodeByUri(t.uri),a.onChange()},a.showCustomQueryNode=function(t){a.open=!0,a.viewMode=2,a.activeNode=t}}function CollectionNodeController(){var t=this;t.$onInit=function(){},t.removeNode=function(){t.onRemoveNode()},t.click=function(){t.onClick()}}function CollectionSearchController(t,e,i,a){var o=this;o.results=[],o.collectionManager=t,o.formatResult=function(t){return a.trustAsHtml(t)},o.getDatabusUrls=function(){if(null!=o.databusUrls)return o.databusUrls;o.databusUrls=[];var t=o.collection.content.root;for(var e of t.childNodes)o.databusUrls.push(e.uri);return o.databusUrls},o.$onInit=function(){o.searchInput="",o.filters={},o.filters.filterArtifact=!1,o.filters.filterGroup=!1,o.searchCooldown=1e3,o.root=QueryNode.createFrom(o.collection.content.root),o.collectionWrapper=new DatabusCollectionWrapper(o.collection),o.autoFocus=!0},o.isInCollection=function(t){let e=t.resource[0].value;return null!=QueryNode.findChildByUri(o.root,e)},o.addToCollection=function(t){var e=o.targetDatabusUrl,i=QueryNode.findChildByUri(o.root,e);if(t.inCollection)QueryNode.removeChildByUri(o.root,t.resource[0].value);else{if("Group"==t.typeName[0].value){let e=new QueryNode(t.resource[0].value,"dataid:group");i.addChild(e),o.onComponentAdded()}if("Artifact"==t.typeName[0].value){var a=t.resource[0].value;let e=DatabusCollectionUtils.navigateUp(a),n=QueryNode.findChildByUri(o.root,e);null==n&&(n=new QueryNode(e,"dataid:group"),i.addChild(n));let r=new QueryNode(a,"dataid:artifact");n.addChild(r),o.onComponentAdded()}}for(let t in o.results)o.results[t].inCollection=o.isInCollection(o.results[t]);o.collectionManager.saveLocally(),console.log(o.root)},i((function(){if(o.searchChanged){if(!DatabusUtils.isValidHttpUrl(o.targetDatabusUrl))return;var t="?typeName=Artifact Group";(o.filters.filterArtifact||o.filters.filterGroup)&&(t="?typeName=",o.filters.filterArtifact&&(t+="Artifact "),o.filters.filterGroup&&(t+="Group ")),o.lastQuery=o.searchInput;try{e({method:"GET",url:o.targetDatabusUrl+"/api/search"+t+"&format=JSON_FULL&minRelevance=10&maxResults=50&query="+o.searchInput}).then((function(t){if(o.lastQuery==t.data.query)for(var e in o.results=t.data.docs,o.results)o.results[e].inCollection=o.isInCollection(o.results[e])}),(function(t){}))}catch(t){}o.searchChanged=!1}}),o.searchCooldown),o.search=function(){o.searchChanged=!0}}function CollectionStatisticsController(t,e,i,a){var o=this;o.$http=t,o.$onInit=function(){o.isLoading=!0,DatabusCollectionUtils.getCollectionStatistics(o.$http,o.collection).then((function(t){o.statistics=t,o.isLoading=!1,e.$apply()}),(function(t){o.statistics=null,o.isLoading=!1}))},o.markdownToHtml=function(t){var e=window.markdownit();return a.trustAsHtml(e.render(t))},o.formatUploadSize=function(t){return DatabusUtils.formatFileSize(t)}}function CollectionStatusController(t,e,i){var a=this;a.$onInit=function(){a.colors=[],a.colors.push("#b54c4c"),a.colors.push("#aaa"),a.colors.push("#aaa"),a.colors.push("#e8ca5f"),a.colors.push("#3a3"),a.labels=[],a.labels.push("Draft"),a.labels.push("Hidden, Uncommitted Changes"),a.labels.push("Hidden"),a.labels.push("Visible, Uncommitted Changes"),a.labels.push("Visible")},a.$doCheck=function(){a.isDraft?a.status=0:a.isPublished?a.status=a.hasLocalChanges?3:4:a.status=a.hasLocalChanges?1:2}}class DatabusAlert{static alert(t,e,i,a){null==a&&(a=3e3),t.$broadcast("onDatabusAlert",{isSuccess:e,message:i,ms:a})}}function DatabusAlertController(t,e){var i=this;t.$on("onDatabusAlert",(function(t,a){i.isSuccess=a.isSuccess,i.message=a.message,i.isVisible=!1,null!=i.hidePromise&&e.cancel(i.hidePromise),e((function(){i.isVisible=!0}),0),i.hidePromise=e((function(){i.isVisible=!1}),a.ms)})),i.$onInit=function(){},i.isSuccess=function(){return i.isSuccess},i.$doCheck=function(){}}function DatabusIconController(){var t=this;t.iconMap={},t.iconMap.databus="m 0.76949155,0.7702454 v 5.24959 l 29.33129045,-10e-4 6.27262,8.8675006 -0.002,32.0824 4.7212,-0.002 V 0.7702354 Z m 18.43511045,8.3952603 -5.68354,0.006 7.1979,10.5484003 -0.004,27.24663 4.70393,-0.002 0.0167,-28.60108 z m -9.4730904,0.002 -8.96510005,0.002 0.004,37.7960503 16.79563045,-0.004 0.001,-26.29103 z m 13.2512904,0 5.59825,8.2188903 -0.0396,29.57614 4.70307,-0.002 0.006,-31.09587 -4.55858,-6.6940403 z",t.iconMap.add="M 11 11 M 2 12 L 11 12 L 11 21 L 12 21 L 12 12 L 21 12 L 21 11 L 12 11 L 12 2 L 11 2 L 11 11 L 2 11 L 2 12",t.iconMap.remove="M 11 11 M 2 12 L 21 12 L 21 11 L 2 11 L 2 12",t.iconMap.delete="M9 3h6v-1.75c0-.066-.026-.13-.073-.177-.047-.047-.111-.073-.177-.073h-5.5c-.066 0-.13.026-.177.073-.047.047-.073.111-.073.177v1.75zm11 1h-16v18c0 .552.448 1 1 1h14c.552 0 1-.448 1-1v-18zm-10 3.5c0-.276-.224-.5-.5-.5s-.5.224-.5.5v12c0 .276.224.5.5.5s.5-.224.5-.5v-12zm5 0c0-.276-.224-.5-.5-.5s-.5.224-.5.5v12c0 .276.224.5.5.5s.5-.224.5-.5v-12zm8-4.5v1h-2v18c0 1.105-.895 2-2 2h-14c-1.105 0-2-.895-2-2v-18h-2v-1h7v-2c0-.552.448-1 1-1h6c.552 0 1 .448 1 1v2h7z",t.iconMap.goto="M21.883 12l-7.527 6.235.644.765 9-7.521-9-7.479-.645.764 7.529 6.236h-21.884v1h21.883z",t.iconMap.edit="M8.071 21.586l-7.071 1.414 1.414-7.071 14.929-14.929 5.657 5.657-14.929 14.929zm-.493-.921l-4.243-4.243-1.06 5.303 5.303-1.06zm9.765-18.251l-13.3 13.301 4.242 4.242 13.301-13.3-4.243-4.243z",t.iconMap.goback="M2.117 12l7.527 6.235-.644.765-9-7.521 9-7.479.645.764-7.529 6.236h21.884v1h-21.883z",t.iconMap.right="M4 .755l14.374 11.245-14.374 11.219.619.781 15.381-12-15.391-12-.609.755z",t.iconMap.left="M20 .755l-14.374 11.245 14.374 11.219-.619.781-15.381-12 15.391-12 .609.755z",t.iconMap.down="M23.245 4l-11.245 14.374-11.219-14.374-.781.619 12 15.381 12-15.391-.755-.609z",t.iconMap["left-thick"]="M16.67 0l2.83 2.829-9.339 9.175 9.339 9.167-2.83 2.829-12.17-11.996z",t.iconMap.help="M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm.053 17c.466 0 .844-.378.844-.845 0-.466-.378-.844-.844-.844-.466 0-.845.378-.845.844 0 .467.379.845.845.845zm.468-2.822h-.998c-.035-1.162.182-2.054.939-2.943.491-.57 1.607-1.479 1.945-2.058.722-1.229.077-3.177-2.271-3.177-1.439 0-2.615.877-2.928 2.507l-1.018-.102c.28-2.236 1.958-3.405 3.922-3.405 1.964 0 3.615 1.25 3.615 3.22 0 1.806-1.826 2.782-2.638 3.868-.422.563-.555 1.377-.568 2.09z",t.iconMap.max="M24 22h-24v-20h24v20zm-7-1v-15h-16v15h16zm1 0h5v-18h-22v2h17v16zm-6-6h-1v-3.241l-7.241 7.241-.759-.759 7.241-7.241h-3.241v-1h5v5z",t.iconMap.min="M24 22h-24v-20h24v20zm-23-9v8h10v-8h-10zm22 8v-18h-22v9h11v9h11zm-4-9h-5v-5h1v3.241l5.241-5.241.759.759-5.241 5.241h3.241v1z",t.iconMap.error="M24 23h-24l12-22 12 22zm-22.315-1h20.63l-10.315-18.912-10.315 18.912zm10.315-2c.466 0 .845-.378.845-.845 0-.466-.379-.844-.845-.844-.466 0-.845.378-.845.844 0 .467.379.845.845.845zm.5-11v8h-1v-8h1z",t.iconMap.info="M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm.5 17h-1v-9h1v9zm-.5-12c.466 0 .845.378.845.845 0 .466-.379.844-.845.844-.466 0-.845-.378-.845-.844 0-.467.379-.845.845-.845z",t.iconMap.eye="M12.01 20c-5.065 0-9.586-4.211-12.01-8.424 2.418-4.103 6.943-7.576 12.01-7.576 5.135 0 9.635 3.453 11.999 7.564-2.241 4.43-6.726 8.436-11.999 8.436zm-10.842-8.416c.843 1.331 5.018 7.416 10.842 7.416 6.305 0 10.112-6.103 10.851-7.405-.772-1.198-4.606-6.595-10.851-6.595-6.116 0-10.025 5.355-10.842 6.584zm10.832-4.584c2.76 0 5 2.24 5 5s-2.24 5-5 5-5-2.24-5-5 2.24-5 5-5zm0 1c2.208 0 4 1.792 4 4s-1.792 4-4 4-4-1.792-4-4 1.792-4 4-4z",t.iconMap["add-artifact"]="M 12 0 M 12.016 1.424 L 21.756 12.053 L 12.016 22.563 L 2.204 12.005 L 3.396 10.721 L 2.774 10.058 L 1 12 L 12 24 L 23 12 L 12 0 L 10.153 2.078 L 10.837 2.741 Z M 6 6 L 6 2 L 7 2 L 7 6 L 11 6 L 11 7 L 7 7 L 7 11 L 6 11 L 6 7 L 2 7 L 2 6 L 6 6",t.iconMap["add-button"]="M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z",t.iconMap.collections="M11.499 12.03v11.971l-10.5-5.603v-11.835l10.5 5.467zm11.501 6.368l-10.501 5.602v-11.968l10.501-5.404v11.77zm-16.889-15.186l10.609 5.524-4.719 2.428-10.473-5.453 4.583-2.499zm16.362 2.563l-4.664 2.4-10.641-5.54 4.831-2.635 10.474 5.775z",t.iconMap["collections-thin"]="M23 6.066v12.065l-11.001 5.869-11-5.869v-12.131l11-6 11.001 6.066zm-21.001 11.465l9.5 5.069v-10.57l-9.5-4.946v10.447zm20.001-10.388l-9.501 4.889v10.568l9.501-5.069v-10.388zm-5.52 1.716l-9.534-4.964-4.349 2.373 9.404 4.896 4.479-2.305zm-8.476-5.541l9.565 4.98 3.832-1.972-9.405-5.185-3.992 2.177z",t.iconMap.content="M9.484 15.696l-.711-.696-2.552 2.607-1.539-1.452-.698.709 2.25 2.136 3.25-3.304zm0-5l-.711-.696-2.552 2.607-1.539-1.452-.698.709 2.25 2.136 3.25-3.304zm0-5l-.711-.696-2.552 2.607-1.539-1.452-.698.709 2.25 2.136 3.25-3.304zm10.516 11.304h-8v1h8v-1zm0-5h-8v1h8v-1zm0-5h-8v1h8v-1zm4-5h-24v20h24v-20zm-1 19h-22v-18h22v18z",t.iconMap.menu="M24 18v1h-24v-1h24zm0-6v1h-24v-1h24zm0-6v1h-24v-1h24z",t.iconMap.copy="M17 7h6v16h-16v-6h-6v-16h16v6zm5 1h-14v14h14v-14zm-6-1v-5h-14v14h5v-9h9z",t.iconMap.upload="M9 16h-8v6h22v-6h-8v-1h9v8h-24v-8h9v1zm11 2c.552 0 1 .448 1 1s-.448 1-1 1-1-.448-1-1 .448-1 1-1zm-7.5 0h-1v-14.883l-4.735 5.732-.765-.644 6.021-7.205 5.979 7.195-.764.645-4.736-5.724v14.884z",t.iconMap.hide="M8.137 15.147c-.71-.857-1.146-1.947-1.146-3.147 0-2.76 2.241-5 5-5 1.201 0 2.291.435 3.148 1.145l1.897-1.897c-1.441-.738-3.122-1.248-5.035-1.248-6.115 0-10.025 5.355-10.842 6.584.529.834 2.379 3.527 5.113 5.428l1.865-1.865zm6.294-6.294c-.673-.53-1.515-.853-2.44-.853-2.207 0-4 1.792-4 4 0 .923.324 1.765.854 2.439l5.586-5.586zm7.56-6.146l-19.292 19.293-.708-.707 3.548-3.548c-2.298-1.612-4.234-3.885-5.548-6.169 2.418-4.103 6.943-7.576 12.01-7.576 2.065 0 4.021.566 5.782 1.501l3.501-3.501.707.707zm-2.465 3.879l-.734.734c2.236 1.619 3.628 3.604 4.061 4.274-.739 1.303-4.546 7.406-10.852 7.406-1.425 0-2.749-.368-3.951-.938l-.748.748c1.475.742 3.057 1.19 4.699 1.19 5.274 0 9.758-4.006 11.999-8.436-1.087-1.891-2.63-3.637-4.474-4.978zm-3.535 5.414c0-.554-.113-1.082-.317-1.562l.734-.734c.361.69.583 1.464.583 2.296 0 2.759-2.24 5-5 5-.832 0-1.604-.223-2.295-.583l.734-.735c.48.204 1.007.318 1.561.318 2.208 0 4-1.792 4-4z",t.iconMap.download="M6 16h-5v6h22v-6h-5v-1h6v8h-24v-8h6v1zm14 2c.552 0 1 .448 1 1s-.448 1-1 1-1-.448-1-1 .448-1 1-1zm-7.5-17v14.884l4.736-5.724.764.645-5.979 7.195-6.021-7.205.765-.644 4.735 5.732v-14.883h1z",t.iconMap.import="M16.965 2.381c3.593 1.946 6.035 5.749 6.035 10.119 0 6.347-5.153 11.5-11.5 11.5s-11.5-5.153-11.5-11.5c0-4.37 2.442-8.173 6.035-10.119l.608.809c-3.353 1.755-5.643 5.267-5.643 9.31 0 5.795 4.705 10.5 10.5 10.5s10.5-4.705 10.5-10.5c0-4.043-2.29-7.555-5.643-9.31l.608-.809zm-4.965-2.381v14.826l3.747-4.604.753.666-5 6.112-5-6.101.737-.679 3.763 4.608v-14.828h1z",t.iconMap.filter="M23 0l-9 14.146v7.73l-3.996 2.124v-9.853l-9.004-14.147h22zm-20.249 1l8.253 12.853v8.491l1.996-1.071v-7.419l8.229-12.854h-18.478z",t.iconMap.check="M9 22l-10-10.598 2.798-2.859 7.149 7.473 13.144-14.016 2.909 2.806z",t.iconMap.settings="M12 8.666c-1.838 0-3.333 1.496-3.333 3.334s1.495 3.333 3.333 3.333 3.333-1.495 3.333-3.333-1.495-3.334-3.333-3.334m0 7.667c-2.39 0-4.333-1.943-4.333-4.333s1.943-4.334 4.333-4.334 4.333 1.944 4.333 4.334c0 2.39-1.943 4.333-4.333 4.333m-1.193 6.667h2.386c.379-1.104.668-2.451 2.107-3.05 1.496-.617 2.666.196 3.635.672l1.686-1.688c-.508-1.047-1.266-2.199-.669-3.641.567-1.369 1.739-1.663 3.048-2.099v-2.388c-1.235-.421-2.471-.708-3.047-2.098-.572-1.38.057-2.395.669-3.643l-1.687-1.686c-1.117.547-2.221 1.257-3.642.668-1.374-.571-1.656-1.734-2.1-3.047h-2.386c-.424 1.231-.704 2.468-2.099 3.046-.365.153-.718.226-1.077.226-.843 0-1.539-.392-2.566-.893l-1.687 1.686c.574 1.175 1.251 2.237.669 3.643-.571 1.375-1.734 1.654-3.047 2.098v2.388c1.226.418 2.468.705 3.047 2.098.581 1.403-.075 2.432-.669 3.643l1.687 1.687c1.45-.725 2.355-1.204 3.642-.669 1.378.572 1.655 1.738 2.1 3.047m3.094 1h-3.803c-.681-1.918-.785-2.713-1.773-3.123-1.005-.419-1.731.132-3.466.952l-2.689-2.689c.873-1.837 1.367-2.465.953-3.465-.412-.991-1.192-1.087-3.123-1.773v-3.804c1.906-.678 2.712-.782 3.123-1.773.411-.991-.071-1.613-.953-3.466l2.689-2.688c1.741.828 2.466 1.365 3.465.953.992-.412 1.082-1.185 1.775-3.124h3.802c.682 1.918.788 2.714 1.774 3.123 1.001.416 1.709-.119 3.467-.952l2.687 2.688c-.878 1.847-1.361 2.477-.952 3.465.411.992 1.192 1.087 3.123 1.774v3.805c-1.906.677-2.713.782-3.124 1.773-.403.975.044 1.561.954 3.464l-2.688 2.689c-1.728-.82-2.467-1.37-3.456-.955-.988.41-1.08 1.146-1.785 3.126",t.$onInit=function(){t.path=t.iconMap[t.shape]}}function DatabusSearchController(t,e,i){var a=this;a.searchResults=[],a.formatResult=function(t){return i.trustAsHtml(t)},a.$onInit=function(){a.input="",a.searchCooldown=1e3,a.hasSearchChanged=!1,a.isSearchReady=!0},a.invokeSearch=function(){a.isSearchReady?(a.search(),a.isSearchReady=!1):a.hasSearchChanged=!0},e((function(){a.hasSearchChanged&&(a.searchscope(),a.hasSearchChanged=!1),a.isSearchReady=!0}),a.searchCooldown),a.search=function(){if(""!=a.input){var e="";null!=a.filters&&a.filters.length>0&&(e="&"+a.filters.join("&")),t({method:"GET",url:"/api/search?query="+a.input+e}).then((function(t){for(var e in a.results=[],t.data.docs){var i=t.data.docs[e],o={label:i.label[0],desc:i.comment[0],uri:i.resource[0],type:i.typeName[0]};a.searchResults.push(o)}}),(function(t){console.log(t)}))}}}function EditLabelController(t){var e=this,i=null;e.$onInit=function(){e.isEdit=!1,i=null},e.edit=function(){e.isEdit=!0},e.$doCheck=function(){i!=e.text&&(e.onChange(),i=e.text)}}function EntityCardController(t){this.$onInit=function(){},this.formatResult=function(e){return t.trustAsHtml(e)}}function ExpandableArrowController(){var t=this;t.$onInit=function(){null==t.isReadonly&&(t.isReadonly=!1)},t.change=function(){t.isReadonly||(t.expanded=!t.expanded,t.onChange())}}class FacetSettings{constructor(t,e){this.facets=t,this.parentFacets=e}changeSetting(t,e,i){return this.findParentSettingState(t,e)!=i?this.createOrAddSetting(t,e,i):this.removeSetting(t,e),i}findParentSettingState(t,e){if(null==this.parentFacets)return!1;for(var i in this.parentFacets){var a=this.parentFacets[i];if(a.key==t&&a.value==e)return a.checked}return!1}findOwnSettingState(t,e){for(var i in this.facets){var a=this.facets[i];if(a.key==t&&a.value==e)return a.checked}return!1}isOverride(t,e,i){return this.findParentSettingState(t,e)!=i}createOrAddSetting(t,e,i){for(var a in this.facets){var o=this.facets[a];if(a==t&&o.value==e)return void(o.checked=i)}this.facets[t]={value:e,checked:i}}removeSetting(t,e){for(var i in this.facets){var a=this.facets[i];if(a.key==t&&a.value==e)return void this.facets.splice(i,1)}}}function FacetsViewController(t,e){var i=this;i.$http=t,i.maxEntries=6,i.$onInit=function(){},i.$onChanges=function(){i.isLoading=!0,i.node=QueryNode.createFrom(i.node),i.viewModel={},null==i.facets&&(i.facets=[]);var t="version"==i.resourceType?i.node.uri+"/"+i.node.facetSettings["http://purl.org/dc/terms/hasVersion"][0].value:i.node.uri;i.$http.get("/app/utils/facets",{params:{uri:t,type:i.resourceType}}).then((function(t){if("group"==i.resourceType&&null!=t.data["http://dataid.dbpedia.org/ns/core#artifact"])for(var e in t.data["http://dataid.dbpedia.org/ns/core#artifact"].values){var a=t.data["http://dataid.dbpedia.org/ns/core#artifact"].values[e];t.data["http://dataid.dbpedia.org/ns/core#artifact"].values[e]=DatabusCollectionUtils.uriToName(a)}for(var o in t.data){var n=t.data[o];for(var r in i.viewModel[o]={},i.viewModel[o].key=o,i.viewModel[o].label=n.label,i.viewModel[o].visibleFacetSettings=[],i.viewModel[o].autofill={},i.viewModel[o].autofill.values=n.values,i.viewModel[o].autofill.selectedValues=[],i.viewModel[o].autofill.input="",n.values){var s={value:a=n.values[r],checked:!1,isOverride:!1};if(i.viewModel[o].visibleFacetSettings.push(s),r>=i.maxEntries-1)break}}if("version"==i.resourceType&&delete i.viewModel[DatabusUris.DCT_HAS_VERSION],"version"!=i.resourceType&&null!=i.viewModel[FACET_VERSION_KEY]){i.viewModel[FACET_VERSION_KEY].visibleFacetSettings.unshift({value:FACET_LATEST_VERSION_VALUE,checked:!1,isOverride:!1});var l=i.node.createFullFacetSettings();for(var o in l){var c=l[o];for(var e in c){s=c[e];null!=(u=i.getOrCreateVisibleFacetSetting(o,s.value))&&(u.checked=s.checked,u.isOverride=i.node.isOverride(o,s.value,s.checked))}}if("group"==i.resourceType){for(var e in i.node.childNodes){var u,d=i.node.childNodes[e],p=DatabusCollectionUtils.uriToName(d.uri);(u=i.getOrCreateVisibleFacetSetting("http://dataid.dbpedia.org/ns/core#artifact",p)).checked=!0,u.isOverride=!0}if(0==i.node.childNodes.length)for(var r of i.viewModel[DatabusUris.DATAID_ARTIFACT_PROPERTY].visibleFacetSettings){var h=i.node.uri+"/"+r.value;d=new QueryNode(h,"dataid:artifact");QueryNode.addChild(i.node,d)}}i.onChange(),i.onLoaded()}i.isLoading=!1}))},i.getFacetLabel=function(t){return t==FACET_LATEST_VERSION_VALUE?FACET_LATEST_VERSION_LABEL:t},i.changeFacetValueState=function(t,e,a){if("group"==i.resourceType&&"http://dataid.dbpedia.org/ns/core#artifact"==t){var o=i.node.uri+"/"+e;if(a){var n=new QueryNode(o,"dataid:artifact");QueryNode.addChild(i.node,n)}else QueryNode.removeChildByUri(i.node,o);null!=(r=i.getOrCreateVisibleFacetSetting(t,e))&&(r.checked=a,r.isOverride=a)}else{var r;i.node.setFacet(t,e,a),null!=(r=i.getOrCreateVisibleFacetSetting(t,e))&&(r.checked=a,r.isOverride=i.node.isOverride(t,e,a))}i.viewModel[t].autofill.selectedValues.length>0&&i.complete(i.viewModel[t]),i.onChange()},i.getOrCreateVisibleFacetSetting=function(t,e){if(null==i.viewModel[t]){var a=DatabusCollectionUtils.uriToName(t);a=a[0].toUpperCase()+a.slice(1),i.viewModel[t]={},i.viewModel[t].key=t,i.viewModel[t].label=a,i.viewModel[t].visibleFacetSettings=[],i.viewModel[t].autofill={},i.viewModel[t].autofill.values=[],i.viewModel[t].autofill.selectedValues=[],i.viewModel[t].autofill.input=""}for(var o in i.viewModel[t].visibleFacetSettings){var n=i.viewModel[t].visibleFacetSettings[o];if(n.value==e)return n}var r={value:e};return i.viewModel[t].visibleFacetSettings.push(r),r},i.getActiveFilters=function(t){var e=[];for(var a in i.facets[t].items){var o=i.facets[t].items[a];o.checked&&e.push(o)}return e},i.hasActiveFilters=function(t){for(var e in i.facets[t].items){if(i.facets[t].items[e].checked)return!0}return!1},i.complete=function(t){for(var e in t.autofill.selectedValues.length=0,t.autofill.values){var i=t.autofill.values[e];if(i.toLowerCase().indexOf(t.autofill.input.toLowerCase())>=0){var a=!0;for(var o in t.visibleFacetSettings){t.visibleFacetSettings[o].value==i.toLowerCase()&&(a=!1)}a&&t.autofill.selectedValues.push(i)}}},i.clearAutofill=function(){var t=i;for(var e in t.viewModel){t.viewModel[e].autofill.selectedValues.length=0}}}function FileBrowserController(t,e){var i=this;i.$http=t,i.activeTab=0,i.$scope=e,i.$onInit=function(){i.lastRequestRevision=0,i.tableLimit=20,i.sortProperty="version.value",i.sortReverse=!1,i.queryResult={}},i.sortBy=function(t){i.sortProperty==t&&(i.sortReverse=!i.sortReverse),i.sortProperty=t},i.getCellValues=function(t,e){if(null==t[e.field])return"";var i=t[e.field].value;return e.uriToName&&(i=DatabusCollectionUtils.uriToName(i)),i},i.formatUploadSize=function(t){return DatabusUtils.formatFileSize(t)},i.createRelativeUri=function(t){return new URL(t).pathname},i.formatVariant=function(t){var e=t.split(", ");for(variant of(t="",e))null!=variant&&""!=variant&&(t+=variant+", ");return""==t?"---":t.substr(0,t.length-2)},i.querySparql=async function(t){i.isLoading=!0,i.totalSize=0,i.numFiles=0;try{var a={method:"POST",url:DATABUS_SPARQL_ENDPOINT_URL,data:"format=json&query="+encodeURIComponent(t),headers:{"Content-type":"application/x-www-form-urlencoded"}},o=(await i.$http(a)).data;for(var n in i.isLoading=!1,i.queryResult.bindings=o.results.bindings,i.queryResult.uriList="",i.queryResult.bindings){var r=i.queryResult.bindings[n];r.size.numericalValue=parseInt(r.size.value),i.queryResult.uriList+=r.file.value+"\n",null!=r.variant&&(r.variant.value=i.formatVariant(r.variant.value)),i.totalSize+=r.size.numericalValue,i.numFiles++}i.totalSize=i.formatUploadSize(i.totalSize),e.$root.$$phase||i.$scope.$apply()}catch(t){console.log(t)}},i.$doCheck=function(){i.query!=i.fileQuery&&(i.fileQuery=i.query,i.querySparql(i.fullQuery))}}function MultiselectArtifactDropdownController(t,e){var i=this;i.$sce=e,i.$onInit=function(){i.artifacts=i.node.artifacts},i.handleKey=function(t){9!==t.which&&13!==t.which||(i.showDrop=!1)},i.hasContent=function(){return node.artifacts.length>0},i.hideDropDelayed=function(){t((function(){i.showDrop=!1}),120)},i.isChecked=function(t){for(var e in i.node.childNodes)if(i.node.childNodes[e].uri==t.artifactUri)return!0;return!1},i.toggle=function(t){var e=QueryNode.createFrom(i.node);if(QueryNode.findChildByUri(e,t.artifactUri))QueryNode.removeChildByUri(e,t.artifactUri);else{let i=new QueryNode(t.artifactUri,"dataid:artifact");e.addChild(i)}i.change()},i.change=function(){t((function(){i.onChange()}),50)}}function MultiselectDropdownController(t,e){var i=this;i.$sce=e,i.searchInput="",i.$onInit=function(){},i.handleKey=function(t){9!==t.which&&13!==t.which||(i.showDrop=!1)},i.getLabel=function(t){return"$latest"==t?"Latest Version":""==t?"None":t},i.hasContent=function(){return!!(null!=i.input&&0!=i.input.length||null!=i.parentInput&&0!=i.parentInput.length)},i.mergeSettings=function(t,e){var i={};if(null!=t)for(var a of t)i[a.value]=a.checked;for(var o in e){i[(a=e[o]).value]=a.checked}return i},i.list=function(){var t=i.mergeSettings(i.parentInput,i.input),e=Object.keys(t).map((function(e,a){var o=void 0;return o=""==e?'<i style="color: #a3a3a3;">None</i>':i.getLabel(e),t[e]?o:`<s>${o}</s>`})),a=[],o=0,n=!1;for(var r of e){if(r.length+o>50){n=!0;break}o+=r.length,a.push(r)}return n&&a.push("..."),i.$sce.trustAsHtml(a.join(", "))},i.hideDropDelayed=function(){t((function(){i.showDrop=!1}),120)},i.includesValue=function(t,e){if(null==t)return!1;for(var i of t)if(i.value==e)return!0;return!1},i.matchesSearch=function(t){return t.includes(i.searchInput)},i.isChecked=function(t,e){if(null==t)return!1;for(var i of t)if(i.value==e)return i.checked;return!1},i.veryStupidDelete=function(t,e){let i=-1,a=0;if(null==t)return!1;for(var o of t){if(o.value==e){i=a;break}a++}t.splice(a,1)},i.toggle=function(t){null==i.input&&(i.input=[]);var e=null!=i.parentInput&&i.includesValue(i.parentInput,t);i.includesValue(i.input,t)?i.veryStupidDelete(i.input,t):i.input.push({value:t,checked:!e}),i.change()},i.change=function(){t((function(){i.onChange()}),50)}}function OverrideCheckboxController(){var t=this;t.$onInit=function(){null==t.id&&(t.id=t.label)},t.change=function(){t.readonly||t.onChange()}}function SearchController(t,e,i){var a=this;a.results=[],a.formatResult=function(t){return i.trustAsHtml(t)},a.toggleFilter=function(t){a.filterActive[t]=!a.filterActive[t],a.search()},a.availableResourceTypes=["Collection","Artifact","Group","PersonalProfileDocument"],a.$onInit=function(){for(var t of(a.searchInput="",a.isSearching=!1,a.searchCooldown=300,null==a.settings?(a.minRelevance=.01,a.maxResults=50,a.searchFilter="",a.resourceTypes=null,a.placeholder="Search the Databus..."):(a.minRelevance=a.settings.minRelevance,a.maxResults=a.settings.maxResults,a.searchFilter=a.settings.filter,a.resourceTypes=a.settings.resourceTypes,a.placeholder=a.settings.placeholder),a.filterActive={},a.filterVisible={},a.availableResourceTypes))a.filterActive[t]=!1,a.filterVisible[t]=null==a.resourceTypes;if(a.numFilters=0,null!=a.resourceTypes)for(var t of a.resourceTypes)a.filterVisible[t]=!0,a.numFilters++},a.isAnyFilterActive=function(){for(var t of a.availableResourceTypes)if(a.filterVisible[t]&&a.filterActive[t])return!0;return!1},e((function(){if(a.searchChanged){var e=`&minRelevance=${a.minRelevance}&maxResults=${a.maxResults}`,i="",o=a.isAnyFilterActive();for(var n of a.availableResourceTypes)a.filterVisible[n]&&(!a.filterActive[n]&&o||(""==i&&(i="&typeName="),i+=` ${n}`));var r=`/api/search?query=${a.searchInput}${a.searchFilter}${e}${i}`;t({method:"GET",url:r}).then((function(t){a.isSearching=!1,a.results=t.data}),(function(t){a.isSearching=!1})),a.searchChanged=!1}}),a.searchCooldown),a.search=function(){a.isSearching=!0,a.searchChanged=!0}}function TableEditorController(){var t=this;t.$onInit=function(){t.selection={},t.edit={},null==t.model.groupMode&&(t.model.groupMode=!0),t.setupColumns(),t.updateViewModel()},t.setupColumns=function(){for(var e in t.columns=[],t.columns.push({title:"File",width:400,isReadonly:!0}),t.columns.push({title:"Format",width:75,isReadonly:!0}),t.columns.push({title:"Compression",width:115,isReadonly:!0}),t.model.contentVariants){var i=t.model.contentVariants[e];t.columns.push({title:i.label,width:120,isReadonly:!1})}t.columns.push({title:"Actions",width:120,isReadonly:!0}),t.progressWidth="315px"},t.toggleGroupMode=function(){t.model.groupMode=!t.model.groupMode,t.updateViewModel()},t.onShowInput=function(t){},t.deselect=function(){t.edit.x=void 0,t.edit.y=void 0,t.selection.x=void 0,t.selection.y=void 0,t.selection.width=0,t.selection.height=0},t.selectCell=function(e,i,a){if(t.selection.x==i&&t.selection.y==a)return t.edit.x=i,void(t.edit.y=a);t.edit.x=void 0,t.edit.y=void 0,t.selection.x=i,t.selection.y=a,t.selection.width=1,t.selection.height=1},t.analyzeFile=function(e){t.onAnalyzeFile({file:e})},t.onChangeCv=function(e,i){for(var a=t.model.files.findIndex((t=>t.uri==e.uri)),o=a+1;o<a+e.rowspan;o++)t.model.files[o].contentVariants[i.label]=e.contentVariants[i.label];t.model.isConfigDirty=!0},t.updateViewModel=function(){for(var e in t.model.files)t.model.files[e].rowspan=1;if(t.model.groupMode)for(var i=0,a=1;i+a<t.model.files.length;)if(t.model.files[i].name==t.model.files[i+a].name){for(var o in t.model.files[i].rowspan++,t.model.files[i+a].rowspan=0,t.model.contentVariants){var n=t.model.contentVariants[o];t.model.files[i+a].contentVariants[n.label]=t.model.files[i].contentVariants[n.label]}a++}else i+=a,a=1},t.removeFileFromArtifact=function(e){t.onRemoveFile({file:e})},t.$doCheck=function(){var e=DatabusUtils.objSize(t.model.files);if(t.numFiles!=e&&(t.updateViewModel(),t.numFiles=e),null!=t.columns){var i=4;for(var a in t.model.contentVariants)i++;t.progressPosition=45;for(var o=0;o<i-3;o++)t.progressPosition+=t.columns[o].width;t.progressPosition=t.progressPosition+"px",t.columns.length!=i&&t.setupColumns()}},t.change=function(){}}function TypeTagController(){var t=this;t.typeMap={},t.typeMap.Artifact="is-artifact",t.typeMap.Version="is-version",t.typeMap.Group="is-group",t.typeMap.Service="is-service",t.typeMap.PersonalProfileDocument="is-consumer",t.typeMap.Collection="is-collection",t.typeMap.BlogEntry="is-blog",t.typeMap.Databus="is-version",t.typeMap.Sparql="is-grey",t.iconMap={},t.iconMap.Artifact="M12,0 L1,12 l11,12 l11,-12 L12,0z",t.iconMap.Version="M 12,0 0.99999997,11.999022 12,23.999999 15.166016,20.546592 A 4.0000001,4.0003251 0 0 1 13,16.99943 a 4.0000001,4.0003251 0 0 1 4,-4.000327 4.0000001,4.0003251 0 0 1 3.378906,1.859527 l 2.621093,-2.859608 z",t.iconMap.Group="M21.698 10.658l2.302 1.342-12.002 7-11.998-7 2.301-1.342 9.697 5.658 9.7-5.658zm-9.7 10.657l-9.697-5.658-2.301 1.343 11.998 7 12.002-7-2.302-1.342-9.7 5.657zm12.002-14.315l-12.002-7-11.998 7 11.998 7 12.002-7z",t.iconMap.Service="M24 13.616v-3.232l-2.869-1.02c-.198-.687-.472-1.342-.811-1.955l1.308-2.751-2.285-2.285-2.751 1.307c-.613-.339-1.269-.613-1.955-.811l-1.021-2.869h-3.232l-1.021 2.869c-.686.198-1.342.471-1.955.811l-2.751-1.308-2.285 2.285 1.308 2.752c-.339.613-.614 1.268-.811 1.955l-2.869 1.02v3.232l2.869 1.02c.197.687.472 1.342.811 1.955l-1.308 2.751 2.285 2.286 2.751-1.308c.613.339 1.269.613 1.955.811l1.021 2.869h3.232l1.021-2.869c.687-.198 1.342-.472 1.955-.811l2.751 1.308 2.285-2.286-1.308-2.751c.339-.613.613-1.268.811-1.955l2.869-1.02zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z",t.iconMap.PersonalProfileDocument="M19 7.001c0 3.865-3.134 7-7 7s-7-3.135-7-7c0-3.867 3.134-7.001 7-7.001s7 3.134 7 7.001zm-1.598 7.18c-1.506 1.137-3.374 1.82-5.402 1.82-2.03 0-3.899-.685-5.407-1.822-4.072 1.793-6.593 7.376-6.593 9.821h24c0-2.423-2.6-8.006-6.598-9.819z",t.iconMap.Collection="M11.499 12.03v11.971l-10.5-5.603v-11.835l10.5 5.467zm11.501 6.368l-10.501 5.602v-11.968l10.501-5.404v11.77zm-16.889-15.186l10.609 5.524-4.719 2.428-10.473-5.453 4.583-2.499zm16.362 2.563l-4.664 2.4-10.641-5.54 4.831-2.635 10.474 5.775z",t.iconMap.BlogEntry="M21 9.662c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0 2.031c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0 2.031c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0 2.031c-2.287.194-5.197 1.038-7 1.794v-1.064c1.933-.721 4.598-1.54 7-1.745v1.015zm0-9.951c-2.402.204-5.068 1.024-7 1.745v1.933c1.804-.756 4.713-1.6 7-1.794v-1.884zm-18 2.843c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0 2.031c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0 2.031c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0 2.032c2.402.205 5.067 1.024 7 1.745v1.064c-1.803-.756-4.713-1.6-7-1.794v-1.015zm0-7.054c2.287.194 5.196 1.038 7 1.794v-1.933c-1.932-.72-4.598-1.54-7-1.744v1.883zm9-2.724c-3.063-1.671-7.776-2.755-12-2.963v17c4.289.206 8.195 1.249 12 3 3.805-1.751 7.711-2.794 12-3v-17c-4.224.208-8.937 1.292-12 2.963zm-10-.791c4.264.496 6.86 1.467 9 2.545v12.702c-2.968-1.184-5.939-1.95-9-2.271v-12.976zm20 12.975c-3.061.321-6.032 1.088-9 2.271v-12.701c2.187-1.103 4.757-2.051 9-2.544v12.974z",t.iconMap.Databus="m 0.76949155,0.7702454 v 5.24959 l 29.33129045,-10e-4 6.27262,8.8675006 -0.002,32.0824 4.7212,-0.002 V 0.7702354 Z m 18.43511045,8.3952603 -5.68354,0.006 7.1979,10.5484003 -0.004,27.24663 4.70393,-0.002 0.0167,-28.60108 z m -9.4730904,0.002 -8.96510005,0.002 0.004,37.7960503 16.79563045,-0.004 0.001,-26.29103 z m 13.2512904,0 5.59825,8.2188903 -0.0396,29.57614 4.70307,-0.002 0.006,-31.09587 -4.55858,-6.6940403 z",t.iconMap.Sparql="M383.476,267.343c-2.544-1.346-5.14-2.493-7.743-3.516l1.863-0.15c0,0-16.608-7.354-18.057-60.722  c-1.438-53.372,15.828-62.478,15.828-62.478l-2.48,0.109c13.045-6.69,24.265-17.267,31.669-31.216  c19.295-36.291,5.488-81.362-30.81-100.657C337.436-10.563,292.374,3.207,273.09,39.53c-7.927,14.899-10.178,31.273-7.677,46.733  l-0.851-1.306c0,0,4.373,19.365-41.032,47.55c-45.397,28.2-65.877,14.159-65.877,14.159l1.302,1.925  c-1.298-0.803-2.544-1.624-3.901-2.333c-36.306-19.294-81.38-5.509-100.667,30.804c-19.281,36.309-5.489,81.365,30.813,100.668  c27.064,14.364,58.974,10.36,81.461-7.655l-0.487,0.946c0,0,16.531-13.599,64.16,11.973c37.601,20.178,43.184,39.956,43.899,47.383  c-0.983,27.57,13.388,54.618,39.389,68.433c36.301,19.299,81.374,5.498,100.657-30.804  C433.571,331.704,419.786,286.624,383.476,267.343z M299.542,277.128c-6.018,2.129-23.203,4.487-59.389-14.921  c-39.187-21.04-45.005-38.615-45.855-43.891c0.557-6.401,0.202-12.791-0.891-19.02l0.239,0.359c0,0-3.189-17.096,41.65-44.943  c40.133-24.908,58.376-19.955,61.771-18.653c2.185,1.485,4.45,2.867,6.825,4.131c4.518,2.398,9.174,4.283,13.888,5.672  c5.52,5.257,15.678,20.178,16.733,59.413c1.078,39.535-10.533,54.779-16.865,60.168C311.122,268.399,305.022,272.34,299.542,277.128  z",t.$onInit=function(){t.class=t.typeMap[t.type],t.icon=t.iconMap[t.type],t.style={},t.style.width=t.width+"px",t.style.height=t.height+"px",t.viewBox="0 0 24 24","Databus"==t.type&&(t.viewBox="2 0 42 40"),"Sparql"==t.type&&(t.viewBox="40 0 430 420")}}function UriBreadcrumbsController(){var t=this;t.$onInit=function(){t.entries=[];var e=t.uri,i=new URL(e).pathname.split("/"),a="";for(var o in i){var n=i[o];""!=n&&(a+=n+"/",t.entries.push({label:n,uri:"/"+a}))}}}function YasqeTextController(t,e){var i=this;i.textField=e.find("textarea"),i.$scope=t,i.$onInit=function(){i.yasqe=YASQE.fromTextArea(i.textField[0],{lineNumbers:!0,viewportMargin:1/0,readOnly:i.readOnly,autorefresh:!0}),i.yasqe.on("change",(function(){i.query=i.yasqe.getValue(),i.valid=!i.yasqe.queryValid,t.$root.$$phase||i.$scope.$apply(),i.onChange()})),i.yasqe.setValue(i.query)},i.$doCheck=function(){null!=i.yasqe&&i.yasqe.getValue()!=i.query&&i.yasqe.setValue(i.query),setTimeout((function(){i.yasqe.refresh()}),10)}}var DEFAULT_IMAGE="https://picsum.photos/id/223/320/320";function AccountPageController(t,e,i){if(t.profileData=data.profile,t.auth=data.auth,t.location=i,null!=t.profileData){encodeURIComponent(`${DATABUS_RESOURCE_BASE_URL}/${t.profileData.accountName}`);t.dataSearchInput="",t.dataSearchSettings={minRelevance:.01,maxResults:10,placeholder:`Search ${t.profileData.accountName}'s data...`,resourceTypes:["Group","Artifact"],filter:`&publisher=${t.profileData.accountName}&typeNameWeight=0`},t.collectionSearchInput="",t.collectionSearchSettings={minRelevance:.01,maxResults:10,placeholder:`Search ${t.profileData.accountName}'s collections...`,resourceTypes:["Collection"],filter:`&publisher=${t.profileData.accountName}&publisherWeight=0&typeNameWeight=0`},t.publishedData={},t.publishedData.isLoading=!0,e.get(`/app/account/content?account=${encodeURIComponent(t.profileData.accountName)}`).then((function(e){for(var i of(t.publishedData.groups=e.data.groups,t.publishedData.artifacts=e.data.artifacts,t.publishedData.artifacts))i.group=DatabusUtils.navigateUp(i.uri,1),i.title=DatabusUtils.stringOrFallback(i.title,i.latestVersionTitle),i.abstract=DatabusUtils.stringOrFallback(i.abstract,i.latestVersionAbstract),i.description=DatabusUtils.stringOrFallback(i.description,i.latestVersionDescription);for(var a of t.publishedData.groups)a.artifacts=t.publishedData.artifacts.filter((function(t){return t.group==a.uri}));t.recentUploads=t.publishedData.artifacts.filter((function(t){return null!=t.latestVersionDate})),t.recentUploads.sort((function(t,e){return new Date(e.latestVersionDate)-new Date(t.latestVersionDate)})),t.recentUploads=t.recentUploads.slice(0,3),t.refreshFeaturedContent()}),(function(t){console.log(t)})),t.statsData={},t.statsData.isLoading=!0,e.get(`/app/account/stats?account=${encodeURIComponent(t.profileData.accountName)}`).then((function(e){t.statsData.stats=e.data,t.statsData.isLoading=!1}),(function(t){console.log(t)})),t.activityData={},t.activityData.isLoading=!0,e.get(`/app/account/activity?account=${encodeURIComponent(t.profileData.accountName)}`).then((function(e){t.activityData.entries=e.data,t.activityData.isLoading=!1}),(function(t){console.log(t)})),t.collectionsData={},t.collectionsData.isLoading=!0,e.get(`/app/account/collections?account=${encodeURIComponent(t.profileData.accountName)}`).then((function(e){t.collectionsData.collections=e.data,t.collectionsData.isLoading=!1,t.refreshFeaturedContent()}),(function(t){console.log(t)})),t.getImageUrl=function(){return null==t.profileData.imageUrl?DEFAULT_IMAGE:t.profileData.imageUrl},t.uriToName=function(t){return DatabusUtils.uriToName(t)},t.formatDateFromNow=function(t){return moment(t).fromNow()},t.formatCollectionDateFromNow=function(t){var e=new Number(t),i=new Date(e);return moment(i).fromNow()},t.formatDate=function(t){return moment(t).format("MMM Do YYYY")+" ("+moment(t).fromNow()+")"},t.profileData.isOwn=t.auth.authenticated&&t.auth.info.accountName==t.profileData.accountName,t.tabViewModel={},t.tabViewModel.activeTab=0,t.tabViewModel.tabs=[],t.tabViewModel.tabs.length=4,t.goToTab=function(t){i.hash(t)},t.$watch("location.hash()",(function(e,i){"settings"==e&&(t.tabViewModel.activeTab=4),"collections"==e&&(t.tabViewModel.activeTab=2),"data"==e&&(t.tabViewModel.activeTab=1),""==e&&(t.tabViewModel.activeTab=0)}),!0);for(var a=["","data","collections","profile"],o=0;o<a.length;o++)t.tabViewModel.tabs[o]={},t.tabViewModel.tabs[o].key=a[o],t.tabViewModel.tabs[o].data=[];t.findFeaturedContent=function(e){for(var i in t.publishedData.groups){var a=t.publishedData.groups[i];if(e==a.uri)return{type:"Group",title:a.title,uri:e,description:a.description};for(var o in a.artifacts){var n=a.artifacts[o];if(e==n.artifactUri)return{type:"Artifact",title:n.title,uri:e,description:n.description}}}for(var r in t.collectionsData.collections){var s=t.collectionsData.collections[r];if(e==s.uri)return{type:"Collection",title:s.title,uri:e,description:s.description}}},t.refreshFeaturedContent=function(){if(null!=t.profileData.featuredContent){var e=t.profileData.featuredContent.split("\n");for(var i in t.featuredContent=[],e){var a=t.findFeaturedContent(e[i]);null!=a&&t.featuredContent.push(a)}}},t.formatUploadSize=function(t){return DatabusUtils.formatFileSize(t)}}}function ArtifactPageController(t,e,i,a){if(t.collectionManager=a,setTimeout((function(){$(".dropdown-item").click((function(t){var e=$(this).closest(".dropdown");$(e).removeClass("is-active"),t.stopPropagation()})),$("body").click((function(){$(".dropdown").removeClass("is-active")})),$(".dropdown").click((function(t){$(".dropdown").removeClass("is-active"),$(this).addClass("is-active"),t.stopPropagation()}))}),500),t.formatUploadSize=function(t){return Math.round(100*t)/100},t.hideAutofill=function(){t.fileSelector.clearAutofill((function(){t.$apply()}))},t.formatResult=function(t){return i.trustAsHtml(t)},t.showCollectionModal=function(){$("#add-to-collection-modal").addClass("is-active")},t.hideCollectionModal=function(){$("#add-to-collection-modal").removeClass("is-active")},t.versions=data.versions,t.artifact=data.artifact,t.artifact.name=DatabusUtils.uriToName(t.artifact.uri),t.publisherName=DatabusUtils.uriToName(DatabusUtils.navigateUp(t.artifact.uri,2)),t.canEdit=t.publisherName==data.auth.info.accountName,data.auth.authenticated&&t.canEdit){t.formData={},t.formData.group={},t.formData.group.name=DatabusUtils.uriToName(DatabusUtils.navigateUp(t.artifact.uri)),t.formData.artifact={};var o=DatabusUtils.createAbstractFromDescription(t.artifact.description);t.formData.artifact.generateAbstract=o==t.artifact.abstract,t.formData.artifact.name=t.artifact.name,t.formData.artifact.title=t.artifact.title,t.formData.artifact.abstract=t.artifact.abstract,t.formData.artifact.description=t.artifact.description,t.dataidCreator=new DataIdCreator(t.formData,data.auth.info.accountName)}t.onDescriptionChanged=function(){null!=t.formData&&t.formData.artifact.generateAbstract&&(t.formData.artifact.abstract=DatabusUtils.createAbstractFromDescription(t.formData.artifact.description))},t.resetEdits=function(){t.formData.artifact.title=t.artifact.title,t.formData.artifact.abstract=t.artifact.abstract,t.formData.artifact.description=t.artifact.description},t.saveArtifact=async function(){if(null!=t.dataidCreator){var i=t.dataidCreator.createArtifactUpdate();200==(await e.put(t.artifact.uri,i)).status&&(t.artifact.title=t.formData.artifact.title,t.artifact.abstract=t.formData.artifact.abstract,t.artifact.description=t.formData.artifact.description,DatabusAlert.alert(t,!0,"Artifact Saved!"),t.$apply())}},t.tabs={},t.tabs.activeTab=0,t.authenticated=data.auth.authenticated,t.fileSelector={},t.fileSelector.config={},t.fileSelector.config.columns=[],t.fileSelector.config.columns.push({field:"version",label:"Version",width:"30%"}),t.fileSelector.config.columns.push({field:"variant",label:"Variant",width:"30%"}),t.fileSelector.config.columns.push({field:"format",label:"Format",width:"12%"}),t.fileSelector.config.columns.push({field:"compression",label:"Compression",width:"12%"}),t.artifactNode=new QueryNode(t.artifact.uri,"dataid:artifact"),t.artifactNode.setFacet("http://purl.org/dc/terms/hasVersion","$latest",!0),t.groupNode=new QueryNode(DatabusUtils.navigateUp(t.artifact.uri),"dataid:group"),t.groupNode.addChild(t.artifactNode),t.collectionWidgetSelectionData={},t.collectionWidgetSelectionData.groupNode=t.groupNode,t.onFacetSettingsChanged=function(){t.fileSelector.query=QueryBuilder.build({node:t.artifactNode,template:QueryTemplates.DEFAULT_FILE_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL}),t.fileSelector.fullQuery=QueryBuilder.build({node:t.artifactNode,template:QueryTemplates.GROUP_PAGE_FILE_BROWSER_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL})},t.onFacetSettingsChanged(),t.markdownToHtml=function(t){var e=window.markdownit();return i.trustAsHtml(e.render(t))},t.onFileSelectionChanged=function(e,i){t.fileSelector.numFiles=e,t.fileSelector.totalSize=i},t.formatId=function(t){return DatabusCollectionUtils.formatId(t)},t.formatDate=function(t){return moment(t).format("MMM Do YYYY")},t.addArtifactNodeToCollection=function(){null!=t.collectionManager.activeCollection&&(new DatabusCollectionWrapper(t.collectionManager.activeCollection).addArtifactNode(t.artifact.uri,t.artifact.title,t.fileSelector.settings),t.collectionManager.saveLocally(),t.statusCode=1)},t.changeCollection=function(e){t.authenticated&&t.collectionManager.setActive(e.uuid)},t.getStatusSuccess=function(){return!0},t.resetStatus=function(){t.statusCode=0},t.getStatusMessage=function(t){return"File selection has been has been added to your collection."}}function CollectionController(t,e,i,a){t.collection=new DatabusCollectionWrapper(data.collection),t.authenticated=data.auth.authenticated,t.activeTab=0,t.collectionViewModel={},t.collectionViewModel.downloadScript=[],t.collectionViewModel.downloadScript.length=3,t.collectionViewModel.downloadScript[0]=`query=$(curl -H "Accept:text/sparql" ${t.collection.uri})`,t.collectionViewModel.downloadScript[1]=`files=$(curl -H "Accept: text/csv" --data-urlencode "query=\${query}" ${DATABUS_RESOURCE_BASE_URL}/sparql | tail -n +2 | sed 's/\\r$//')`,t.collectionViewModel.downloadScript[2]='while IFS= read -r file ; do wget $file; done <<< "$files"',t.collectionViewModel.downloadManual="To fetch the query via *curl* run \n``` shell\n"+t.collectionViewModel.downloadScript[0]+"\n```\n\n\nTo download the files additionally run\n``` shell\n"+t.collectionViewModel.downloadScript[1]+"\n"+t.collectionViewModel.downloadScript[2]+"\n```",t.collectionQuery=t.collection.createQuery(),t.collectionManager=a,t.collectionFiles="",DatabusCollectionUtils.getCollectionFileURLs(i,t.collection).then((function(e){t.collectionFiles=e,t.$apply()}),(function(t){console.log(t)})),t.authenticated&&(t.username=data.auth.info.username),t.formatUploadSize=function(t){return DatabusUtils.formatFileSize(t)},t.markdownToHtml=function(t){var i=window.markdownit();return e.trustAsHtml(i.render(t))},t.editCopy=function(){if(!t.collectionManager.isInitialized)return;let e=t.collectionManager.createCopy(t.collection);t.collectionManager.setActive(e.uuid),window.location.href="/app/collection-editor"},t.createSnapshot=function(){if(!t.collectionManager.isInitialized)return;let e=t.collectionManager.createSnapshot(t.collection);console.log(e),t.collectionManager.setActive(e.uuid),window.location.href="/app/collection-editor"},t.editCollection=function(){if(!t.collectionManager.isInitialized)return;let e=t.collectionManager.getCollectionByUri(t.collection.uri);if(null===e)return console.log("editCollection failed due there is no collection with that uri: "+t.collection.uri),void t.editCopy();t.collectionManager.setActive(e.uuid),window.location.href="/app/collection-editor"},t.downloadAsJson=function(){DatabusCollectionUtils.exportToJsonFile(t.collection)},t.queryToClipboard=function(){DatabusCollectionUtils.copyStringToClipboard(t.collectionQuery),t.statusCode=DatabusResponse.COLLECTION_QUERY_COPIED_TO_CLIPBOARD},t.openInYasgui=function(){window.location.href="https://databus.dbpedia.org/yasgui?query="+encodeURIComponent(t.collectionQuery)},t.bashScriptToClipboard=function(){DatabusCollectionUtils.copyStringToClipboard(t.collectionViewModel.downloadScript[0]+"\n"+t.collectionViewModel.downloadScript[1]+"\n"+t.collectionViewModel.downloadScript[2]),t.statusCode=DatabusResponse.COLLECTION_BASH_COPIED_TO_CLIPBOARD},t.markdownToHtml=function(t){let i=window.markdownit();return e.trustAsHtml(i.render(t))},t.filesToClipboard=function(){DatabusCollectionUtils.copyStringToClipboard(t.collectionFiles),t.statusCode=DatabusResponse.COLLECTION_DOWNLOAD_URLS_COPIED_TO_CLIPBOARD},t.getStatusMessage=function(t){return DatabusResponse.Message[t]},t.getStatusSuccess=function(){return t.statusCode>=2e3&&t.statusCode<3e3},t.resetStatus=function(){t.statusCode=0}}function CollectionsEditorController(t,e,i,a,o){if(t.authenticated=data.auth.authenticated,t.accountName=data.auth.info.accountName,t.location=a,t.baseUrl=DATABUS_RESOURCE_BASE_URL,t.onDescriptionChanged=function(){null!=t.form&&(t.form.generateAbstract&&(t.collectionManager.activeCollection.abstract=DatabusUtils.createAbstractFromDescription(t.collectionManager.activeCollection.description)),t.onActiveCollectionChanged())},t.$watch("location.hash()",(function(e,i){null!=t.session&&(t.session.activeTab="import"!=e?"query"!=e?"preview"!=e?"content"!=e?"docu"!=e?0:1:2:3:4:5)}),!0),t.goToTab=function(t){a.hash(t),window.scrollTo(0,0)},t.logMeIn=function(){window.location="/system/login?redirectUrl="+encodeURIComponent(window.location)},t.createAccount=function(){window.location="/app/account"},t.authenticated&&(t.hasAccount=null!=data.auth.info.accountName,t.hasAccount)){t.getCollectionJson=function(){var e=DatabusCollectionUtils.createCleanCopy(t.collectionManager.activeCollection);return delete e.uuid,e},t.collectionManager=o,t.collectionQuery=new DatabusCollectionWrapper(t.collectionManager.activeCollection).createQuery(),t.collectionJson=t.getCollectionJson();var n=`databus_collection_editor_session_${data.auth.info.accountName}`;t.session=JSON.parse(window.sessionStorage.getItem(n)),null==t.session&&(t.session={},t.session.activeTab=0,t.session.showDescription=!0,t.session.showGroups=!0),t.$watch("session",(function(e,i){window.sessionStorage.setItem(n,JSON.stringify(t.session))}),!0),t.form={},t.form.label={},t.form.identifier={},t.form.description={},t.form.collectionPublishTag="",t.form.generateAbstract=t.collectionManager.activeCollection.abstract==DatabusUtils.createAbstractFromDescription(t.collectionManager.activeCollection.description),t.username=data.auth.info.accountName,t.onCollectionClicked=function(e){e.uuid==t.collectionManager.activeCollection.uuid&&0==t.session.activeTab&&t.goToTab("docu"),t.setActiveCollection(e)},t.setActiveCollection=function(e){e.uuid!=t.collectionManager.activeCollection.uuid&&(t.collectionManager.setActive(e.uuid),t.form.identifier.value=DatabusUtils.uriToName(t.collectionManager.activeCollection.uri))},t.collectionManager.onCollectionChangedInDifferentTab=function(){},t.doStuffWhenInitialized=function(){null==t.collectionManager.activeCollection&&t.collectionManager.selectFirstOrCreate(),t.setActiveCollection(t.collectionManager.activeCollection)},o.isInitialized?t.doStuffWhenInitialized():o.onReady=t.doStuffWhenInitialized,t.onActiveCollectionChanged=function(){t.collectionManager.saveLocally();let e=t.collectionManager.activeCollection;t.collectionQuery=new DatabusCollectionWrapper(e).createQuery(),t.collectionJson=t.getCollectionJson(),null!=e&&(e.hasLocalChanges=t.collectionManager.hasLocalChanges(e))},t.getStatusMessage=function(t){return DatabusResponse.Message[t]},t.getStatusSuccess=function(){return t.statusCode>=2e3&&t.statusCode<3e3},t.resetStatus=function(){t.statusCode=0},t.preview=function(){window.location.href="/"+t.username+"/collections/"+t.collectionManager.activeCollection.id},t.createNewCollection=function(){t.collectionManager.createNew("New Collection","Replace this description with a description of your choice.",(function(e){DatabusAlert.alert(t,!0,"A new collection has been created.")}))},t.editCopy=function(){var e=t.collectionManager.createCopy(t.collectionManager.activeCollection);t.collectionManager.setActive(e.uuid)},t.saveCollection=function(){if(t.collectionManager.isInitialized){var i=void 0;null!=t.collectionManager.activeCollection.uri&&(i=DatabusUtils.uriToName(t.collectionManager.activeCollection.uri)),null==i&&(DatabusCollectionUtils.checkIdentifier(t.form.identifier.value)?(t.form.identifier.error=void 0,i=t.form.identifier.value):t.form.identifier.error=DatabusResponse.COLLECTION_INVALID_ID),DatabusCollectionUtils.checkCollectionForm(t.form,t.collectionManager.activeCollection)&&null!=i&&(t.isSaving=!0,t.collectionManager.updateCollection(t.username,i).then((function(i){DatabusAlert.alert(t,!0,"Collection saved successfully."),t.isSaving=!1,t.$apply(),t.updateStatistics(t.collectionManager.activeCollection),e(t.resetStatus,t.modalTime)})).catch((function(e){DatabusAlert.alert(t,!1,e),t.isSaving=!1,t.$apply()})))}},t.createDraft=function(){t.collectionManager.isInitialized&&t.collectionManager.createDraft((function(i){t.statusCode=i,t.isSaving=!1,e(t.resetStatus,t.modalTime)}))},t.showDeleteModal=function(){t.deleteModalVisible=!0},t.hideDeleteModal=function(){t.deleteModalVisible=!1},t.deleteCollection=function(){t.collectionManager.isInitialized&&(t.deleteModalVisible=!1,t.collectionManager.deleteCollection(t.username,t.form.identifier.value).then((function(i){t.statusCode=i.code,t.collectionManager.selectFirstOrCreate(),t.setActiveCollection(t.collectionManager.activeCollection),t.$apply(),e(t.resetStatus,t.modalTime)})).catch((function(i){t.statusCode=i.code,t.$apply(),e(t.resetStatus,t.modalTime)})))},t.unHideCollection=function(){var i=void 0;null!=t.collectionManager.activeCollection.uri&&(i=DatabusUtils.uriToName(t.collectionManager.activeCollection.uri)),null!=i&&t.collectionManager.unHideCollection(t.username,i).then((function(i){t.statusCode=DatabusResponse.COLLECTION_PUBLISHED,t.$apply(),e(t.resetStatus,t.modalTime)})).catch((function(i){t.statusCode=i.code,t.$apply(),e(t.resetStatus,t.modalTime)}))},t.hideCollection=function(){var i=void 0;null!=t.collectionManager.activeCollection.uri&&(i=DatabusUtils.uriToName(t.collectionManager.activeCollection.uri)),null!=i&&t.collectionManager.hideCollection(t.username,i).then((function(i){t.statusCode=DatabusResponse.COLLECTION_UNPUBLISHED,t.$apply(),e(t.resetStatus,t.modalTime)})).catch((function(i){t.statusCode=i.code,t.$apply(),e(t.resetStatus,t.modalTime)}))},t.deleteLocally=function(){t.collectionManager.isInitialized&&t.collectionManager.deleteLocally((function(e){t.statusCode=e.code}))},t.downloadAsJson=function(){DatabusCollectionUtils.exportToJsonFile(t.collectionManager.activeCollection)},t.discardChanges=function(){t.isDoingCommitWork=!0,i.get(`/app/account/collections?account=${t.accountName}`).then((function(e){t.collectionManager.discardLocalChanges(e.data),t.statusCode=DatabusResponse.COLLECTION_LOCAL_CHANGES_DISCARDED,t.isDoingCommitWork=!1}))},t.queryToClipboard=function(){var e=DatabusCollectionUtils.createQueryString(t.collectionManager.activeCollection);DatabusCollectionUtils.copyStringToClipboard(e),t.statusCode=DatabusResponse.COLLECTION_QUERY_COPIED_TO_CLIPBOARD},t.showLoadFromJson=function(){t.isLoadFromJsonVisible=!0},t.hideLoadFromJson=function(){t.isLoadFromJsonVisible=!1},t.loadFromJsonString="",t.loadFromJson=function(e){try{var i=JSON.parse(e),a=t.collectionManager.activeCollection;a.title=i.title,a.description=i.description,a.content=i.content,t.statusCode=DatabusResponse.COLLECTION_IMPORTED,t.isLoadFromJsonVisible=!1}catch(e){t.statusCode=DatabusResponse.COLLECTION_IMPORTED_FAILED}}}}function FrontPageController(t,e,i){for(var a in t.databusName=DATABUS_NAME,t.auth=data.auth,t.activityChartData={},t.activityChartData.isLoading=!0,t.searchQuery="",t.searchSettings={minRelevance:20,maxResults:25,placeholder:"Search the Databus...",resourceTypes:void 0,filter:"&typeNameWeight=0"},i.get("/app/index/activity").then((function(e){t.activityChartData.entries=e.data,t.activityChartData.isLoading=!1}),(function(t){console.log(t)})),t.uploadRankingData={},t.uploadRankingData.isLoading=!0,i.get("/app/index/ranking").then((function(e){t.uploadRankingData.data=e.data,t.uploadRankingData.isLoading=!1}),(function(t){console.log(t)})),t.recentUploadsData={},t.recentUploadsData.isLoading=!0,i.get("/app/index/recent").then((function(e){t.recentUploadsData.data=e.data,t.recentUploadsData.isLoading=!1}),(function(t){console.log(t)})),t.formatUploadSize=function(t){return Math.round(100*t)/100},t.uploadRankingData)t.uploadRankingData[a].uploadSize=t.formatUploadSize(t.uploadRankingData[a].uploadSize);for(var a in t.formatDate=function(t){return moment(t).format("MMM Do YYYY")+" ("+moment(t).fromNow()+")"},t.formatLicense=function(t){var i='<div class="license-icon is-primary">'+DatabusUtils.uriToName(t)+"</div>";return e.trustAsHtml(i)},t.recentUploadsData)t.recentUploadsData[a].date=t.formatDate(t.recentUploadsData[a].date),t.recentUploadsData[a].licenseTag=t.formatLicense(t.recentUploadsData[a].license)}function GroupPageController(t,e,i,a,o){for(var n of(t.group=data.group,t.artifacts=data.artifacts,t.services=data.services,t.group.name=DatabusUtils.uriToName(t.group.uri),t.publisherName=DatabusUtils.uriToName(DatabusUtils.navigateUp(t.group.uri)),t.group.hasData=!1,t.artifacts))null!=n.latestVersionDate&&(t.group.hasData=!0);for(var n of(t.group.title=DatabusUtils.stringOrFallback(t.group.title,DatabusUtils.uriToTitle(t.group.uri)),t.artifacts))n.title=DatabusUtils.stringOrFallback(n.title,n.latestVersionTitle),n.abstract=DatabusUtils.stringOrFallback(n.abstract,n.latestVersionAbstract),n.description=DatabusUtils.stringOrFallback(n.description,n.latestVersionDescription);if(t.canEdit=t.publisherName==data.auth.info.accountName,data.auth.authenticated&&t.canEdit){var r=DatabusUtils.createAbstractFromDescription(t.group.description);t.formData={},t.formData.group={},t.formData.group.generateAbstract=r==t.group.abstract,t.formData.group.name=t.group.name,t.formData.group.title=t.group.title,t.formData.group.abstract=t.group.abstract,t.formData.group.description=t.group.description,t.dataidCreator=new DataIdCreator(t.formData,data.auth.info.accountName)}for(var s in t.onDescriptionChanged=function(){null!=t.formData&&t.formData.group.generateAbstract&&(t.formData.group.abstract=DatabusUtils.createAbstractFromDescription(t.formData.group.description))},t.resetEdits=function(){t.formData.group.title=t.group.title,t.formData.group.abstract=t.group.abstract,t.formData.group.description=t.group.description},t.saveGroup=async function(){if(null!=t.dataidCreator){var i=t.dataidCreator.createGroupUpdate();200==(await e.put(t.group.uri,i)).status&&(t.group.title=t.formData.group.title,t.group.abstract=t.formData.group.abstract,t.group.description=t.formData.group.description,DatabusAlert.alert(t,!0,"Group Saved!"),t.$apply())}},t.facetsView={},t.facetsView.resourceUri=t.group.uri,t.facetsView.settings=[],t.facetsView.parentSettings=null,t.tabs={},t.tabs.activeTab=0,t.authenticated=data.auth.authenticated,t.selection=[],t.searchInput="",t.searchCooldown=500,t.searchChanged=!0,t.searchReady=!0,t.fileSelector={},t.fileSelector.config={},t.fileSelector.config.columns=[],t.fileSelector.config.columns.push({field:"artifact",label:"Artifact",width:"32%",uriToName:!0}),t.fileSelector.config.columns.push({field:"version",label:"Version",width:"12%"}),t.fileSelector.config.columns.push({field:"variant",label:"Variant",width:"17%"}),t.fileSelector.config.columns.push({field:"format",label:"Format",width:"8%"}),t.fileSelector.config.columns.push({field:"compression",label:"Compression",width:"10%"}),t.groupNode=new QueryNode(t.group.uri,"dataid:group"),t.groupNode.setFacet("http://purl.org/dc/terms/hasVersion","$latest",!0),t.onFacetSettingsChanged=function(){t.fileSelector.query=QueryBuilder.build({node:t.groupNode,template:QueryTemplates.DEFAULT_FILE_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL}),t.fileSelector.fullQuery=QueryBuilder.build({node:t.groupNode,template:QueryTemplates.GROUP_PAGE_FILE_BROWSER_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL})},t.collectionWidgetSelectionData={},t.collectionWidgetSelectionData.groupNode=t.groupNode,t.onFileQueryResult=function(e){null!=e&&(t.collectionWidgetSelectionData.query=e.query)},t.collectionManager=o,t.findArtifact=function(e){return t.artifacts.find((function(t){t.uri}))},t.formatResult=function(t){return i.trustAsHtml(t)},t.formatDate=function(t){return moment(t).format("MMM Do YYYY")+" ("+moment(t).fromNow()+")"},t.formatLicense=function(t){var e='<div class="license-icon">'+DatabusUtils.uriToName(t)+"</div>";return i.trustAsHtml(e)},t.artifacts)t.artifacts[s].date=t.formatDate(t.artifacts[s].date),t.artifacts[s].licenseTag=t.formatLicense(t.artifacts[s].license);t.setSelectionStateAll=function(e){if(e)for(var i in t.artifacts)t.select(t.artifacts[i]);else for(var i in t.artifacts)t.deselect(t.artifacts[i])},t.toggleSelect=function(e){t.isSelected(e)?t.deselect(e):t.select(e)},t.select=function(e){e.isSelected=!0,t.selection.push(e.uri)},t.deselect=function(e){e.isSelected=!1,t.selection=t.selection.filter((function(t,i,a){return t!==e.uri}))},t.isSelected=function(e){for(var i in t.selection)if(t.selection[i]===e.uri)return!0;return!1},t.changeCollection=function(e){t.collectionManager.setActive(e.uuid),t.search()},t.showCollectionModal=function(){$("#add-to-collection-modal").addClass("is-active")},t.hideCollectionModal=function(){$("#add-to-collection-modal").removeClass("is-active")},t.markdownToHtml=function(t){var e=window.markdownit();return i.trustAsHtml(e.render(t))},t.invokeSearch=function(){t.searchReady?(t.search(),t.searchReady=!1):t.searchChanged=!0},a((function(){t.searchChanged&&(t.search(),t.searchChanged=!1),t.searchReady=!0}),t.searchCooldown),t.addSelectionToCollection=function(){if(null!=t.collectionManager.activeCollection){var e=new DatabusCollectionWrapper(t.collectionManager.activeCollection);for(var i in t.selection){var a=t.artifacts.find((function(e){return e.uri===t.selection[i]}));e.addArtifactNode(a.uri,a.label)}t.collectionManager.saveLocally(),t.search()}},t.updateArtifactState=function(e,i){i.alreadyAdded=e.hasArtifact(i.uri),i.isSelected=i.alreadyAdded||t.selection.includes(i.uri)},t.search=function(){t.searchResult=[];var i=`&publisher=${t.publisherName}&publisherWeight=0&typeName=Artifact&typeNameWeight=0&group=${t.group.name}&minRelevance=0.1`;e({method:"GET",url:"/api/search?query="+t.searchInput+i}).then((function(e){for(var i in e.data.docs){var a=e.data.docs[i];for(var o of t.artifacts)a.resource[0]==o.uri&&t.searchResult.push(o)}}),(function(t){}))}}function HeaderController(t,e,i){t.auth=data.auth,t.authenticated=data.auth.authenticated,t.databusCookieConsentKey="databus_cookie_consent";let a=window.localStorage.getItem(t.databusCookieConsentKey);if(t.showCookieDialogue=void 0===a,t.authenticated){t.collectionManager=i;var o=t.collectionManager.accountName!=t.auth.info.accountName;t.collectionManager.tryInitialize(t.auth.info.accountName,o)}t.hideAccountMenu=function(){t.isAccountMenuActive=!1},t.showAccountMenu=function(){t.isAccountMenuActive=!0},t.getAccountName=function(){return t.auth.info.accountName?t.auth.info.accountName:t.auth.info.oidc_email?t.auth.info.oidc_email:t.auth.info.oidc_name?t.auth.info.oidc_name:null},t.isMenuActive=!1,t.isAccountMenuActive=!1,t.giveCookieConsent=function(){window.localStorage.setItem(t.databusCookieConsentKey,!0),t.showCookieDialogue=!1},t.login=function(){window.location="/app/login?redirectUrl="+encodeURIComponent(window.location)},t.logout=function(){t.hideAccountMenu(),window.location="/app/logout?redirectUrl="+encodeURIComponent(window.location)},t.size=function(){if(null==t.collectionManager)return"";var e=t.collectionManager.current;return null!=e?e.elements.length:""}}function ProfileController(t,e){t.profileData=data.profile,t.auth=data.auth,t.preferredDatabusUsername="",t.apiKeys=data.auth.info.apiKeys,t.createApiKeyName="",t.createAccountError="",t.createApiKeyError="",t.addWebIdUri="",t.grantAccessUri="",t.personUri=`${DATABUS_RESOURCE_BASE_URL}/${t.auth.info.accountName}#this`,t.putProfile=function(i,a){var o=`${DATABUS_RESOURCE_BASE_URL}/${i}`,n=`${DATABUS_RESOURCE_BASE_URL}/${i}#this`,r={"@graph":[{"@id":n,"@type":["http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/DBpedian"],"http://xmlns.com/foaf/0.1/account":{"@id":o},"http://xmlns.com/foaf/0.1/img":{"@id":""},"http://xmlns.com/foaf/0.1/name":a},{"@id":o,"@type":"http://xmlns.com/foaf/0.1/PersonalProfileDocument","http://xmlns.com/foaf/0.1/maker":{"@id":n},"http://xmlns.com/foaf/0.1/primaryTopic":{"@id":n}}]};e.put(`/${i}`,r).then((function(t){t.data.code==DatabusResponse.USER_PROFILE_CREATED&&window.location.reload(!0)}),(function(e){console.log(e),t.createAccountError=e.data}))},null!=t.profileData?(t.removeApiKey=function(i){e.post(`/api/account/api-key/delete?name=${i.keyname}`).then((function(e){t.apiKeys=t.apiKeys.filter((function(t){return t.keyname!=i.keyname}))}),(function(e){console.log(e),t.createApiKeyError=e.data}))},t.onCreateApiKeyNameChanged=function(){var e=!DatabusUtils.isValidResourceLabel(t.createApiKeyName,3,20);t.createApiKeyError=e?" API key name must have between 3 and 20 characters and match [A-Za-z0-9\\s_()\\.\\,\\-]*":""},t.copyToClipboard=function(t){DatabusUtils.copyStringToClipboard(t)},t.addApiKey=function(){e.post(`/api/account/api-key/create?name=${encodeURIComponent(t.createApiKeyName)}`).then((function(e){null!=e.data&&t.apiKeys.push(e.data)}),(function(e){console.log(e),t.createApiKeyError=e.data}))},t.grantAccess=function(){e.post(`/api/account/access/grant?uri=${encodeURIComponent(t.grantAccessUri)}`).then((function(e){t.profileData.authorizedAccounts.push(t.grantAccessUri)}),(function(e){console.log(e),t.grantAccessError=e.data}))},t.revokeAccess=function(i){e.post(`/api/account/access/revoke?uri=${encodeURIComponent(i)}`).then((function(e){t.profileData.authorizedAccounts=t.profileData.webIds.filter((function(t,e,a){return t!=i}))}),(function(e){console.log(e),t.grantAccessError=e.data}))},t.connectWebid=function(){e.post(`/api/account/webid/add?uri=${encodeURIComponent(t.addWebIdUri)}`).then((function(e){t.profileData.webIds.push(t.addWebIdUri)}),(function(e){console.log(e),t.addWebIdError=e.data}))},t.removeWebId=function(i){e.post(`/api/account/webid/remove?uri=${encodeURIComponent(i)}`).then((function(e){t.profileData.webIds=t.profileData.webIds.filter((function(t,e,a){return t!=i}))}),(function(e){console.log(e),t.addWebIdError=e.data}))},t.saveProfile=function(){if(t.auth.authenticated){var i=`${DATABUS_RESOURCE_BASE_URL}/${t.auth.info.accountName}`,a=`${DATABUS_RESOURCE_BASE_URL}/${t.auth.info.accountName}#this`,o={"@context":JSONLD_CONTEXT,"@graph":[{"@id":i,"@type":"foaf:PersonalProfileDocument",maker:a,primaryTopic:a},{"@id":a,"@type":["dbo:DBpedian","foaf:Person"],name:t.editData.label,"rdfs:comment":t.editData.about,account:i,img:t.editData.imageUrl}]};null!=t.editData.webIdURI&&""!=t.editData.webIdURI&&o["@graph"].push({"@id":t.editData.webIdURI,account:i}),e.put("/"+t.auth.info.accountName,o).then((function(t){t.data.code==DatabusResponse.USER_PROFILE_UPDATED&&window.location.reload(!0)}),(function(t){console.log(t)}))}},t.profileData.isOwn&&(t.editData=DatabusUtils.createCleanCopy(t.profileData),t.resetEdits=function(){t.editData=DatabusUtils.createCleanCopy(t.profileData)})):t.createProfile=function(){if(t.auth.authenticated){var e=t.preferredDatabusUsername;if(null==e||!DatabusUtils.isValidAccountName(e))return t.createAccountError="Enter a valid account name.",void(t.showAccountNameHints=!0);var i=e;t.showAccountNameHints=!1,t.putProfile(e,i,"")}}}function PublishWizardController(t,e,i,a){t.login=function(){window.location="/app/login?redirectUrl="+encodeURIComponent(window.location)},t.createAccount=function(){window.location="/app/account"},t.authenticated=data.auth.authenticated,t.loadRequestCount=0,t.texts=data.texts,t.nerdMode={},t.nerdMode.enabled=!1,t.nerdMode.customJson="",t.nerdMode.logLevelOptions=["error","info","debug"],t.nerdMode.logLevel="error",t.authenticated&&(t.hasAccount=null!=data.auth.info.accountName,t.hasAccount&&(t.getContentForAccount=async function(i){t.isAccountDataLoading=!0;var a=`/app/account/content?account=${encodeURIComponent(i)}`,o=await e.get(a);t.isAccountDataLoading=!1;var n=o.data;for(var r of(n.accountName=i,n.publisherUris=[],data.publisherData))n.publisherUris.push(r.publisherUri);var s=PublishSession.resume(n);null==s&&(s=new PublishSession(null,n)),t.session=s,t.$watch("session",(function(){t.session.onChange()}),!0),t.$apply()},t.getContentForAccount(data.auth.info.accountName),t.licenseQuery="",t.filterLicenses=function(e){var i=e.toLowerCase().split(" ");t.filteredLicenseList=data.licenseData.results.bindings.filter((function(t){for(var e of i)if(!t.title.value.toLowerCase().includes(e))return!1;return!0}))},t.filterLicenses(""),t.addFile=function(i){var a=t.session;null!=i&&0!=i.length&&(t.loadRequestCount++,e.get("/app/publish-wizard/fetch-file?url="+encodeURIComponent(i)).then((function(e){t.loadRequestCount--,null!=e.data&&""!=e.data&&200==e.status&&a.addFile(e.data)}),(function(t){})))},t.objSize=function(t){return DatabusUtils.objSize(t)},t.removeFile=function(e){var i=t.session.formData.version.files;i.splice(i.findIndex((t=>t.uri==e.uri)),1),t.session.formData.version.isConfigDirty=!0},t.hasError=function(t,e){return t.includes(e)},t.fetchFiles=function(i){e.get("/app/publish-wizard/fetch-resource-page?url="+encodeURIComponent(i)).then((function(e){for(var i in e.data){var a=e.data[i];t.addFile(a)}}),(function(t){}))},t.addFiles=function(e){var i=e.split("\n");for(var a of i)null!=a&&a.length>0&&t.addFile(a)},t.createTractate=function(i){t.creatingTracate=!0,e.post("/api/tractate/v1/canonicalize",i).then((function(e){t.session.data.signature.tractate=e.data,t.creatingTracate=!1}),(function(e){t.creatingTracate=!1,console.log(e)}))},t.customPublish=async function(){var i={headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}};t.isPublishing=!0,e.post(`/api/publish?fetch-file-properties=true&log-level=${t.nerdMode.logLevel}`,t.nerdMode.customJson,i).then((function(e){t.publishLog=e.data.log,t.isPublishing=!1}),(function(e){t.publishLog=e.data.log,t.isPublishing=!1,console.log(e)}))},t.publish=async function(){var i={headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}};t.isPublishing=!0,e.post("/api/publish?fetch-file-properties=true&log-level=info",t.session.inputs.all,i).then((function(e){t.publishLog=e.data.log,t.isPublishing=!1}),(function(e){t.publishLog=e.data.log,t.isPublishing=!1,console.log(e)}))}))}function VersionPageController(t,e,i,a){if(setTimeout((function(){$(".dropdown-item").click((function(t){var e=$(this).closest(".dropdown");$(e).removeClass("is-active"),t.stopPropagation()})),$("body").click((function(){$(".dropdown").removeClass("is-active")})),$(".dropdown").click((function(t){$(".dropdown").removeClass("is-active"),$(this).addClass("is-active"),t.stopPropagation()}))}),500),t.tabs={},t.tabs.activeTab=0,t.collectionManager=a,t.actions=data.actions,t.versionGraph=JsonldUtils.getTypedGraph(data.version,DatabusUris.DATAID_VERSION),t.version={},t.version.uri=t.versionGraph[DatabusUris.JSONLD_ID],t.version.title=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DCT_TITLE),t.version.abstract=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DCT_ABSTRACT),t.version.description=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DCT_DESCRIPTION),t.version.artifact=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DATAID_ARTIFACT_PROPERTY),t.version.license=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DCT_LICENSE),t.version.attribution=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DATAID_ATTRIBUTION),t.version.wasDerivedFrom=JsonldUtils.getProperty(t.versionGraph,DatabusUris.PROV_WAS_DERIVED_FROM),t.version.issued=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DCT_ISSUED),t.version.name=JsonldUtils.getProperty(t.versionGraph,DatabusUris.DCT_HAS_VERSION),t.serviceData=data.services,t.modsData=data.mods,t.queryResult={},t.addToCollectionQuery="",t.authenticated=data.auth.authenticated,t.collectionModalVisible=!1,t.publisherName=DatabusUtils.uriToName(DatabusUtils.navigateUp(t.version.uri,3)),t.canEdit=t.publisherName==data.auth.info.accountName,data.auth.authenticated&&t.canEdit){t.licenseQuery="",e.get("https://api.dalicc.net/licenselibrary/list?limit=10000").then((function(e){t.licenseData=JSON.parse(e)}),(function(t){console.log("Failed to load license data from dalicc.net: "+t)})),t.filterLicenses=function(e){if(null!=t.licenseData){var i=e.toLowerCase().split(" ");t.filteredLicenseList=t.licenseData.results.bindings.filter((function(t){for(var e of i)if(!t.title.value.toLowerCase().includes(e))return!1;return!0}))}},t.filterLicenses(""),t.formData={},t.formData.group={},t.formData.group.name=DatabusUtils.uriToName(DatabusUtils.navigateUp(t.version.uri,2)),t.formData.artifact={},t.formData.artifact.name=DatabusUtils.uriToName(DatabusUtils.navigateUp(t.version.uri,1));var o=DatabusUtils.createAbstractFromDescription(t.version.description);t.formData.version={},t.formData.version.generateAbstract=o==t.version.abstract,t.formData.version.name=t.version.name,t.formData.version.title=t.version.title,t.formData.version.abstract=t.version.abstract,t.formData.version.description=t.version.description,t.formData.version.license=t.version.license,t.formData.version.attribution=t.version.attribution,t.formData.version.wasDerivedFrom=t.version.wasDerivedFrom,t.formData.signature={},t.formData.signature.autoGenerateSignature=!0,t.formData.signature.selectedPublisherUri=t.version.publisher,t.dataidCreator=new DataIdCreator(t.formData,data.auth.info.accountName)}t.onDescriptionChanged=function(){null!=t.formData&&t.formData.version.generateAbstract&&(t.formData.version.abstract=DatabusUtils.createAbstractFromDescription(t.formData.version.description))},t.resetEdits=function(){t.formData.version.title=t.version.title,t.formData.version.abstract=t.version.abstract,t.formData.version.description=t.version.description},t.saveVersion=async function(){null!=t.dataidCreator&&(JsonldUtils.setLiteral(t.versionGraph,DatabusUris.DCT_TITLE,DatabusUris.XSD_STRING,t.formData.version.title),JsonldUtils.setLiteral(t.versionGraph,DatabusUris.DCT_ABSTRACT,DatabusUris.XSD_STRING,t.formData.version.abstract),JsonldUtils.setLiteral(t.versionGraph,DatabusUris.DCT_DESCRIPTION,DatabusUris.XSD_STRING,t.formData.version.description),JsonldUtils.setLink(t.versionGraph,DatabusUris.DCT_LICENSE,t.formData.version.license),JsonldUtils.setLiteral(t.versionGraph,DatabusUris.DATAID_ATTRIBUTION,DatabusUris.XSD_STRING,t.formData.version.attribution),t.formData.version.wasDerivedFrom&&JsonldUtils.setLink(t.versionGraph,DatabusUris.PROV_WAS_DERIVED_FROM,t.formData.version.wasDerivedFrom),200==(await e.put(t.version.uri,data.version)).status&&(t.version.title=t.formData.version.title,t.version.abstract=t.formData.version.abstract,t.version.description=t.formData.version.description,t.version.license=t.formData.version.license,t.version.attribution=t.formData.version.attribution,t.version.wasDerivedFrom=t.formData.version.wasDerivedFrom,DatabusAlert.alert(t,!0,"Version Saved!"),t.$apply()))},t.modsAmountMinimized=5,t.modsMaxAmount=t.modsAmountMinimized,t.showAllMods=function(){t.modsMaxAmount=1e7},t.hideAllMods=function(){t.modsMaxAmount=t.modsAmountMinimized},t.fileSelector={},t.fileSelector.config={},t.fileSelector.config.columns=[],t.fileSelector.config.columns.push({field:"variant",label:"Variant",width:"45%"}),t.fileSelector.config.columns.push({field:"format",label:"Format",width:"15%"}),t.fileSelector.config.columns.push({field:"compression",label:"Compression",width:"15%"}),t.artifactNode=new QueryNode(t.version.artifact,"dataid:artifact"),t.artifactNode.setFacet("http://purl.org/dc/terms/hasVersion",t.version.name,!0),t.groupNode=new QueryNode(DatabusCollectionUtils.navigateUp(t.version.artifact),"dataid:group"),t.groupNode.addChild(t.artifactNode),t.collectionWidgetSelectionData={},t.collectionWidgetSelectionData.groupNode=t.groupNode,t.onFacetSettingsChanged=function(){t.fileSelector.query=QueryBuilder.build({node:t.artifactNode,template:QueryTemplates.DEFAULT_FILE_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL}),t.fileSelector.fullQuery=QueryBuilder.build({node:t.artifactNode,template:QueryTemplates.GROUP_PAGE_FILE_BROWSER_TEMPLATE,resourceBaseUrl:DATABUS_RESOURCE_BASE_URL})},t.onFacetSettingsChanged(),t.hideAutofill=function(){t.fileSelector.clearAutofill((function(){t.$apply()}))},t.onFileSelectionChanged=function(e,i,a){t.addToCollectionQuery=a},t.showCollectionModal=function(){t.collectionModalVisible=!0},t.hideCollectionModal=function(){t.collectionModalVisible=!1},t.addFilter=function(e,i){t.fileSelector.addFilter(e,i),t.updateQueryBuilder()},t.addQueryToCollection=function(){t.collectionManager.addElement(t.queryBuilder.query),t.hideCollectionModal()},t.formatUploadSize=function(t){return DatabusUtils.formatFileSize(t)},t.formatDate=function(t){return moment(t).format("MMM Do YYYY")},t.formatId=function(t){return DatabusCollectionUtils.formatId(t)},t.addQueryToCollection=function(){null!=t.collectionManager.activeCollection&&(new DatabusCollectionWrapper(t.collectionManager.activeCollection).addCustomQueryNode("Select "+t.versionData.label+" files",t.addToCollectionQuery),t.collectionManager.saveLocally(),t.collectionModalVisible=!1)},t.formatMods=function(t){var e=t.replace(",","&nbsp;");return i.trustAsHtml(e)},t.formatModFile=function(t){return DatabusCollectionUtils.uriToName(t)},t.markdownToHtml=function(t){var e=window.markdownit();return i.trustAsHtml(e.render(t))}}class DataIdCreator{constructor(t,e){this.accountName=e,this.formData=t}createInputs(){var t=this.createGroupUpdate(),e=this.createArtifactUpdate(),i=this.createVersionUpdate(),a={"@context":this.getContext(),"@graph":[]};if(null!=t)for(var o of t["@graph"])a["@graph"].push(o);if(null!=e)for(var o of e["@graph"])a["@graph"].push(o);if(null!=i)for(var o of i["@graph"])a["@graph"].push(o);return{context:this.getContext(),group:t,artifact:e,dataid:i,all:a}}getValidString(t){if(null!=t&&0!=t.length)return t}getContext(){return null!=DATABUS_CONTEXT_URL&&DatabusUtils.isValidHttpUrl(DATABUS_CONTEXT_URL)?DATABUS_CONTEXT_URL:DATABUS_CONTEXT[DatabusUris.JSONLD_CONTEXT]}createGroupUpdate(){var t=`${DATABUS_RESOURCE_BASE_URL}/${this.accountName}`;return{"@context":this.getContext(),"@graph":[{"@id":`${t}/${this.formData.group.name}`,"@type":"Group",title:this.getValidString(this.formData.group.title),abstract:this.getValidString(this.formData.group.abstract),description:this.getValidString(this.formData.group.description)}]}}createArtifactUpdate(){if(!this.formData.group.publishGroupOnly){var t=`${DATABUS_RESOURCE_BASE_URL}/${this.accountName}`;return{"@context":this.getContext(),"@graph":[{"@id":`${t}/${this.formData.group.name}/${this.formData.artifact.name}`,"@type":"Artifact",title:this.getValidString(this.formData.artifact.title),abstract:this.getValidString(this.formData.artifact.abstract),description:this.getValidString(this.formData.artifact.description)}]}}}createVersionUpdate(){if(!this.formData.group.publishGroupOnly){var t=`${`${DATABUS_RESOURCE_BASE_URL}/${this.accountName}`}/${this.formData.group.name}/${this.formData.artifact.name}/${this.formData.version.name}`,e=this.formData.artifact,i=this.formData.version,a={"@type":["Version","Dataset"],"@id":t,publisher:this.formData.signature.selectedPublisherUri,hasVersion:i.name,title:i.title,abstract:i.abstract,description:i.description,license:i.license,attribution:i.attribution,wasDerivedFrom:i.wasDerivedFrom,distribution:[]};this.formData.signature.selectedPublisherUri==this.formData.signature.defaultPublisherUri&&delete a.publisher,this.formData.signature.autoGenerateSignature||(a.proof={"@type":"dataid:DatabusTractateV1",signature:this.formData.signature.userSignature});var o=[];for(var n in i.files){var r=i.files[n],s="";for(var l in i.contentVariants){var c=i.contentVariants[l];null!=(d=r.contentVariants[c.id])&&""!=d&&(s+="_"+c.id+"="+d)}e.name;s,"none"!=r.formatExtension&&("."+r.formatExtension,"."+r.formatExtension),"none"!=r.compression&&("."+r.compression,"."+r.compression);var u={"@type":"Part",formatExtension:r.formatExtension,compression:r.compression,downloadURL:r.uri,byteSize:r.byteSize,sha256sum:r.sha256sum};for(var l in i.contentVariants){var d;c=i.contentVariants[l];null!=(d=r.contentVariants[c.id])&&""!=d&&(u["dcv:"+c.id]=d,o.includes(c.id)||o.push(c.id))}a.distribution.push(u)}return{"@context":this.getContext(),"@graph":[a]}}}}"object"==typeof module&&module&&module.exports&&(module.exports=DataIdCreator);class ShasumClient{constructor(t,e,i){this.proxyUri=e,this.q=t,this.maxStreams=i,this.processes={},this.streamQueue=[]}getActiveProcessCount(){var t=0;for(var e in this.processes)this.processes[e].isDone||t++;return t}analyzeFile(t){this.getActiveProcessCount()<this.maxStreams?this.startSha256Task(t):this.streamQueue.push(t)}analyzeAllFiles(t){for(var e in this.processes={},this.streamQueue=[],fileGroups){var i=fileGroups[e];for(var a in i.distributions){var o=i.distributions[a];this.streamQueue.push(o)}}for(var n=0;n<Math.min(this.streamQueue.length,this.maxStreams);n++)this.startSha256Task(this.streamQueue[n]);return this.streamQueue.splice(0,this.maxStreams),this.shasumCreationProcess}startShasumGeneration(t){for(var e in this.processes={},this.streamQueue=[],t){var i=t[e];for(var a in i.distributions){var o=i.distributions[a];this.streamQueue.push(o)}}for(var n=0;n<Math.min(this.streamQueue.length,this.maxStreams);n++)this.startSha256Task(this.streamQueue[n]);return this.streamQueue.splice(0,this.maxStreams),this.shasumCreationProcess}hasError(t){for(var e in t.distributions){var i=t.distributions[e];if(this.processes[i.uri].hasError)return!0}return!1}isSuccess(t){for(var e in t.distributions){var i=t.distributions[e],a=this.processes[i.uri];if(null==a||!a.isDone||a.hasError)return!1}return!0}isDone(){if(this.streamQueue>0)return!1;for(var t in this.processes)if(!this.processes[t].isDone)return!1;return!0}onShasumFinished(){this.streamQueue.length>0&&(this.startSha256Task(this.streamQueue[0]),this.streamQueue.splice(0,1))}startSha256Task=function(t){var e={isDone:!1},i=this;this.generateSha256Deferred(t).then((function(a){e.result=a.result,e.isDone=!0,e.isSuccess=!0,t.byteSize=a.result.byteSize,t.sha256sum=a.result.shasum,i.onShasumFinished()}),(function(t){e.result=t,e.isDone=!0,e.hasError=!0,i.onShasumFinished()}),(function(t){e.progress=t.progress})),this.processes[t.uri]=e};generateSha256Deferred=function(t){var e=this.q.defer(),i=this.proxyUri+encodeURIComponent(t.uri);return fetch(i,{headers:this.authHeader,credentials:"include"}).then((function(i){var a=null,o=new TextDecoder("utf-8");!function i(n){return n.read().then((({done:r,value:s})=>{var l=o.decode(s).split("$");for(var c in l){var u=l[c];if(u.includes("/")){var d=l[c].split("/");e.notify({uri:t.uri,progress:Math.floor(100*d[0]/d[1])}),d[1]}else null!=l&&u.length>0&&(a=JSON.parse(u))}if(r)return e.resolve({uri:t.uri,result:a}),!0;i(n)}),(function(i){e.reject({uri:t.uri,message:i})}))}(i.body.getReader())}),(function(i){e.reject({uri:t.uri,message:i})})),e.promise}}class PublishData{constructor(t,e){this.accountData=e,this.group=null!=t?t.group:{},this.artifact=null!=t?t.artifact:{},this.version=null!=t?t.version:{},this.signature=null!=t?t.signature:void 0,null==t&&(this.group.createNew=!0,this.group.generateAbstract=!0,this.artifact.createNew=!0,this.artifact.generateAbstract=!0,this.version.generateAbstract=!0,this.version.useArtifactTitle=!0,this.signature=this.createSignatureData())}createSignatureData(){var t={publisherUris:[]};return t.publisherUris=this.accountData.publisherUris,t.defaultPublisherUri=`${DATABUS_RESOURCE_BASE_URL}/${this.accountData.accountName}#this`,t.selectedPublisherUri=t.defaultPublisherUri,t.autoGenerateSignature=!0,t.autoGenerateSignatureLocked=!1,t.userSignature="",t}hasError(t){}validate(){var t=!1;this.group.errors=[],this.artifact.errors=[],this.version.errors=[],this.group.warnings=[],this.artifact.warnings=[],this.version.warnings=[],DatabusUtils.isValidGroupName(this.group.name)||(this.group.errors.push("err_invalid_group_name"),t=!0);var e=this;if(this.accountData.groups.filter((function(t){return t.name==e.group.name})).length>0&&this.group.createNew&&this.group.warnings.push("warning_group_exists"),this.accountData.artifacts.filter((function(t){return t.groupName==e.group.name&&t.name==e.artifact.name})).length>0&&this.artifact.createNew&&this.artifact.warnings.push("warning_artifact_exists"),this.group.generateAbstract&&(this.group.abstract=DatabusUtils.createAbstractFromDescription(this.group.description)),this.version.generateAbstract&&(this.version.abstract=DatabusUtils.createAbstractFromDescription(this.version.description)),this.version.useArtifactTitle&&(this.version.title=this.artifact.title),this.artifact.generateAbstract&&(this.artifact.abstract=DatabusUtils.createAbstractFromDescription(this.artifact.description)),this.group.publishGroupOnly)this.hasConfigurationError=t;else{if(DatabusUtils.isValidArtifactName(this.artifact.name)||(this.artifact.errors.push("err_invalid_artifact_name"),t=!0),DatabusUtils.isValidVersionIdentifier(this.version.name)||(this.version.errors.push("err_invalid_version_name"),t=!0),DatabusUtils.isValidUrl(this.version.license)||(this.version.errors.push("err_invalid_version_license"),t=!0),DatabusUtils.isValidResourceText(this.version.abstract,1)||(this.version.errors.push("err_invalid_version_abstract"),t=!0),DatabusUtils.isValidResourceText(this.version.description,1)||(this.version.errors.push("err_invalid_version_description"),t=!0),0==DatabusUtils.objSize(this.version.files)&&(this.version.errors.push("err_no_files"),t=!0),this.version.isConfigDirty){var i=[];for(var a in this.version.files)this.version.files[a].errors=[],i.push(this.version.files[a]);this.cvSplit(this.version,i,0),this.version.isConfigDirty=!1}this.hasConfigurationError=t}}addFile(t){for(var e in null==this.version.files&&(this.version.files=[]),this.version.files)if(t.url==this.version.files[e].url)return;var i=t.url,a=i.split("/").pop(),o=a.split(".");(a=o[0]).length>50&&(a=a.substr(0,50)+"..."),a=decodeURIComponent(a),this.version.files.push({id:i,uri:t.url,name:a,contentVariants:{},compression:t.compression,formatExtension:t.formatExtension,artifactId:void 0,groupId:void 0}),this.version.files.sort((function(t,e){var i=t.name,a=e.name;return i<a?-1:i>a?1:0})),this.version.isConfigDirty=!0}addContentVariant(t){if(null!=t&&""!=t){for(var e in null==this.version.contentVariants&&(this.version.contentVariants=[]),this.version.contentVariants)if(this.version.contentVariants[e].id==t)return;this.version.contentVariants.push({label:t,id:t,fillRegex:"",toLower:!0,pruneWhitespaces:!0}),this.version.isConfigDirty=!0}}removeContentVariant(t){for(var e in this.version.contentVariants=this.version.contentVariants.filter((function(e){return e.id!=t.id})),this.version.files){delete this.version.files[e].contentVariants[t.id]}this.version.isConfigDirty=!0}fill(t){var e=t.fillRegex;for(var i of this.version.files)t.toLower&&(e=e.toLowerCase()),t.pruneWhitespaces&&(e=e.replaceAll(" ","")),!t.overwrite&&null!=i.contentVariants[t.id]&&i.contentVariants[t.id].length>0||(i.contentVariants[t.id]=e);this.version.isConfigDirty=!0}fillByRegex(t){var e=new RegExp(t.fillRegex);for(var i in this.version.files){var a=this.version.files[i],o=a.name.match(e);if(null!=o){var n=o[0];if(t.toLower&&(n=n.toLowerCase()),t.pruneWhitespaces&&(n=n.replaceAll(" ","")),!t.overwrite&&null!=a.contentVariants[t.id]&&a.contentVariants[t.id].length>0)continue;a.contentVariants[t.id]=n}}this.version.isConfigDirty=!0}createVersionName(t){0==t&&(this.version.name=(new Date).toISOString().slice(0,10)),1==t&&(this.version.name=(new Date).toISOString().slice(0,13))}getRowIndex(t,e){var i=1;for(var a in t){if(t[a].name==e)return i;i++}return-1}cvSplit(t,e,i){if(!(e.length<=1))if(null==t.contentVariants&&(t.contentVariants=[]),i-2>=t.contentVariants.length){if(e.length>1){var a=[];if(0==t.contentVariants.length)a.push("No content variants have been added yet. Add content variants in the files panel in order to tag your files.");else for(var o in t.contentVariants){var n=t.contentVariants[o],r=e[0].contentVariants[n.id];null!=r&&""!=r||(r="none"),a.push(n.id+": "+r)}for(var s in e){var l=0;if(0==s)l=this.getRowIndex(t.files,e[1].name);else l=this.getRowIndex(t.files,e[0].name);var c="Content variants of files need to be unique. Duplicate content variant setting found at row "+l+" ("+a.join(", ")+").";e[s].errors.push({key:"err_duplicate_file",message:c})}}}else{var u={};for(var s in e){var d=e[s],p=null;null!=(p=0==i?d.formatExtension:1==i?d.compression:d.contentVariants[t.contentVariants[i-2].id])&&""!=p||(p="$_none$"),null==u[p]&&(u[p]=[]),u[p].push(d)}for(var h in u)this.cvSplit(t,u[h],i+1)}}getOrCreateFileGroup(t,e){return null==this.version.files&&(this.version.files={}),null==this.version.files[t]&&(this.version.files[t]={id:t,name:e,contentVariants:{},distributions:[],artifactId:void 0,groupId:void 0}),this.version.files[t]}}class PublishSession{static sessionStorageKey="databus_upload";static sessionStorageIgnoreKeys=["$$hashKey","eventListeners","hasLocalChanges","fileFilterInput","fileSuggestions","progress","streamQueue"];constructor(t,e){for(var i of(this.accountData=e,this.accountData.groups))i.artifacts=this.accountData.artifacts.filter((function(t){return t.groupName==i.name})),i.hasArtifacts=i.artifacts.length>0;this.formData=new PublishData(null!=t?t.formData:null,e),this.formData.validate(),this.initializeField(t,"showContext",!1),this.initializeField(t,"fetchFilesInput",""),this.initializeField(t,"addFileInput",""),this.initializeField(t,"isAccountDataLoading",!0),this.initializeField(t,"addFileInput",""),this.initializeField(t,"currentArtifact",null),this.initializeField(t,"currentGroup",null),null!=t&&(this.selectGroup(t.currentGroup),this.selectArtifact(t.currentArtifact)),this.dataIdCreator=new DataIdCreator(this.formData,this.accountData.accountName),this.inputs=this.dataIdCreator.createInputs()}selectGroup(t){if(null!=t){var e=this.formData.group,i=this.formData.artifact;e.name=t.name,e.title=t.title,e.abstract=t.abstract,e.description=t.description,null!=this.currentGroup&&this.currentGroup.name==t.name||(this.currentGroup=t,this.currentArtifact=null,this.setCreateNewArtifact(i.createNew))}}selectArtifact(t){if(null!=t){var e=this.formData.artifact;e.name=t.name,e.title=t.title,e.abstract=t.abstract,e.description=t.description,this.currentArtifact=t}}setCreateNewGroup(t){if(t)this.formData.group.createNew=!0,this.formData.group.name="",this.formData.group.title="",this.formData.group.abstract="",this.formData.group.description="",this.formData.group.generateAbstract=!0,this.currentGroup=null,this.setCreateNewArtifact(!0);else{if(this.formData.group.publishGroupOnly=!1,!(DatabusUtils.objSize(this.accountData.groups)>0))return void this.setCreateNewGroup(!0);if(null==this.currentGroup)for(var e of this.accountData.groups){this.selectGroup(e);break}}}setCreateNewArtifact(t){if(t)this.formData.artifact.createNew=t,this.formData.artifact.name="",this.formData.artifact.title="",this.formData.artifact.description="",this.currentArtifact=null;else{if(!this.currentGroup.hasArtifacts)return void this.setCreateNewArtifact(!0);null==this.currentArtifact&&this.selectArtifact(this.currentGroup.artifacts[0])}}initializeField(t,e,i){this[e]=null!=t?t[e]:i}save(){try{var t=JSON.stringify(this,(function(t,e){if(!PublishSession.sessionStorageIgnoreKeys.includes(t))return e}));window.sessionStorage.setItem(PublishSession.sessionStorageKey,t)}catch(t){console.log(t)}}addFile(t){this.formData.addFile(t)}static resume(t){var e=JSON.parse(window.sessionStorage.getItem(PublishSession.sessionStorageKey));return null==e||null==e.accountData||e.accountData.accountName!=t.accountName?null:new PublishSession(e,t)}onChange(){this.formData.validate(),this.inputs=this.dataIdCreator.createInputs(),this.save(),null!=this.dataIdCreator&&(this.inputs=this.dataIdCreator.createInputs(),this.isReadyForUpload=!this.formData.artifact.errors.length>0&&!this.formData.group.errors.length>0&&!this.formData.version.errors.length>0)}}class QueryBuilder{static build(t){return(new QueryBuilder).createQuery(t.node,t.template,t.resourceBaseUrl)}createQuery(t,e,i){return console.log(typeof QueryNode),"function"!=typeof QueryNode?require("./query-node").assignParents(t):QueryNode.assignParents(t),this.result="",this.cvCounter=0,this.resourceBaseUrl=i,this.select=e.select,this.template=e.body,this.templateInsertionKey=null!=e.placeholder?e.placeholder:"%QUERY%",this.prefixes=e.prefixes,this.aggregate=e.aggregate,this.stringSuffix="",this.appendLine(this.select,0),this.appendLine("{",0),this.createNodeSubquery(t,e.indent,!1),this.appendLine("}",0),null!=this.aggregate&&this.appendLine(this.aggregate,0),this.prependPrefixes(),this.result}removeAndCollectPrefixes(t){var e=t.split("\n"),i="";for(var a of e)a.toLowerCase().startsWith("prefix")?this.prefixes.push(a):i+=a+"\n";return i.substring(0,i.length-1)}prependPrefixes(){for(var t of(this.prefixes="function"!=typeof DatabusUtils?require("./../utils/databus-utils").uniqueList(this.prefixes):DatabusUtils.uniqueList(this.prefixes),this.prefixes))this.prependLine(t,0)}appendTemplateHeader(t){for(var e of this.template){if(e==this.templateInsertionKey)break;this.appendLine(e,t)}}appendTemplateFooter(t){var e=!1;for(var i of this.template)e&&this.appendLine(i,t),i==this.templateInsertionKey&&(e=!0)}appendTemplate(t,e){this.appendTemplateHeader(e),this.createNodeSubquery(t,e+1,!0),null==t.property&&0==t.childNodes.length&&this.appendLine("?distribution a dataid:Nonsense .",e+1),this.appendTemplateFooter(e)}createNodeSubquery(t,e,i){null==i&&(i=!1);var a=this.findSourceUri(t);if(i||null==a){if(null!=t.uri)if(!("function"!=typeof DatabusUtils?require("./../utils/databus-utils").isValidHttpUrl(t.uri):DatabusUtils.isValidHttpUrl(t.uri))){var o=this.removeAndCollectPrefixes(t.property).split("\n");for(var n of o)this.appendLine(n,e);return}null!=t.property&&this.appendLine(`?dataset ${t.property} <${t.uri}> .`,e),this.createNodeFacetsSubquery(t,e);var r=0;for(var s in t.childNodes){if(r>0&&this.appendLine("UNION",e),null==t.childNodes[s].childNodes)return;null==t.childNodes[s].property&&0==t.childNodes[s].childNodes.length||(this.appendLine("{",e),this.createNodeSubquery(t.childNodes[s],e+1,i),this.appendLine("}",e),r++)}return this.result}a!=this.resourceBaseUrl?(this.appendLine(`SERVICE <${a}/sparql>`,e),this.appendLine("{",e),this.appendTemplate(t,e+1),this.appendLine("}",e)):this.appendTemplate(t,e)}findSourceUri(t){return null==t.uri?null:("function"!=typeof DatabusUtils?require("./../utils/databus-utils").isValidHttpUrl(t.uri):DatabusUtils.isValidHttpUrl(t.uri))?new URL(t.uri).origin:null}createNodeFacetsSubquery(t,e){var i=this.findAllNodeFacets(t);for(var a in i){var o=i[a];this.hasFacetOverride(t,o)||this.createFacetSubquery(t,o,e)}}hasFacetOverride(t,e){if(0==t.childNodes.length)return!1;if("http://purl.org/dc/terms/hasVersion"==e)for(var i in t.facetSettings[e])if("$latest"==t.facetSettings[e][i].value)return!0;for(var i in t.childNodes){var a=t.childNodes[i];if(null!=a.facetSettings[e])return!0;if(this.hasFacetOverride(a,e))return!0}return!1}createFacetSubquery(t,e,i){var a=!0,o=this.createEnrichedSettings(t,e);if(1==(o=o.filter((function(t){return t.checked}))).length){if(!(r=o[0]).checked)return;"$latest"==r.value&&"http://purl.org/dc/terms/hasVersion"==e?(this.appendLine("{",i),this.appendLine("?distribution dct:hasVersion ?version {",i+1),this.appendLine("SELECT (?v as ?version) { ",i+2),this.appendLine("GRAPH ?g2 { ",i+3),this.appendLine(`?dataset ${t.property} <${t.uri}> . `,i+4),this.appendLine("?dataset dct:hasVersion ?v . ",i+4),this.appendLine("}",i+3),this.appendLine("} ORDER BY DESC (STR(?version)) LIMIT 1 ",i+2),this.appendLine("}",i+1),this.appendLine("}",i)):this.appendLine(`{ ?distribution <${e}> '${r.value}'${this.stringSuffix} . }`,i)}else if(o.length>1)if("http://purl.org/dc/terms/hasVersion"==e)for(var n in o){(r=o[n]).checked&&(a||this.appendLine("UNION",i),"$latest"==r.value&&"http://purl.org/dc/terms/hasVersion"==e?(this.appendLine("{",i),this.appendLine("?distribution dct:hasVersion ?version {",i+1),this.appendLine("SELECT (?v as ?version) { ",i+2),this.appendLine("GRAPH ?g2 { ",i+3),this.appendLine(`?dataset ${t.property} <${t.uri}> . `,i+4),this.appendLine("?dataset dct:hasVersion ?v . ",i+4),this.appendLine("}",i+3),this.appendLine("} ORDER BY DESC (STR(?version)) LIMIT 1 ",i+2),this.appendLine("}",i+1),this.appendLine("}",i)):this.appendLine(`{ ?distribution <${e}> '${r.value}'${this.stringSuffix} . }`,i),a=!1)}else{for(var n in this.appendLine("{",i),this.appendLine(`?distribution <${e}> ?c${this.cvCounter} .`,i+1),this.appendLine(`VALUES ?c${this.cvCounter} {`,i+1),o){var r;(r=o[n]).checked&&this.appendLine(`'${r.value}'${this.stringSuffix}`,i+2)}this.appendLine("}",i+1),this.appendLine("}",i),this.cvCounter++}}findAllNodeFacets(t){var e=[];for(var i in t.facetSettings)e.push(i);for(var a=t.parent;null!=a;){for(var i in a.facetSettings)this.hasFacetOverride(a,i)&&(e.includes(i)||e.push(i));a=a.parent}return e}createEnrichedSettings(t,e){var i=[];for(var a in t.facetSettings[e])i.push(t.facetSettings[e][a]);for(var o=t.parent;null!=o;){for(var a in o.facetSettings[e]){var n=o.facetSettings[e][a],r=!1;for(var s in i)if(i[s].value==n.value){r=!0;break}r||i.push(n)}o=o.parent}return i}appendLine(t,e){for(var i=0;i<e;i++)this.result+="\t";this.result+=t,this.result+="\n"}prependLine(t,e){for(var i="",a=0;a<e;a++)i+="\t";i+=t,this.result=i+"\n"+this.result}}"object"==typeof module&&module&&module.exports&&(module.exports=QueryBuilder);class QueryNode{constructor(t,e){this.uri=t,this.property=e,this.childNodes=[],this.facetSettings={}}setFacet(t,e,i){var a=this.facetSettings[t];if(null==a&&(this.facetSettings[t]=[],a=this.facetSettings[t]),this.isOverride(t,e,i)){for(var o in a)if(a[o].value==e)return void(a[o].checked=i);a.push({value:e,checked:i})}else{for(var o=0;o<a.length;o++)a[o].value==e&&a.splice(o,1);0==a.length&&delete this.facetSettings[t]}}isOverride(t,e,i){if(null==i){var a=QueryNode.findFacetSetting(this,t,e);i=null!=a&&a.checked}var o=QueryNode.findInheritedSetting(this.parent,t,e);return null==o?i:o.checked!=i}addChild(t){this.childNodes.push(t),t.parent=this}static removeChildByUri(t,e){for(var i=0;i<t.childNodes.length;i++){if(t.childNodes[i].uri==e)return void t.childNodes.splice(i,1);QueryNode.removeChildByUri(t.childNodes[i],e)}}static findChildByUri(t,e){for(let i=0;i<t.childNodes.length;i++){if(t.childNodes[i].uri===e)return t.childNodes[i]=QueryNode.createFrom(t.childNodes[i]),t.childNodes[i];let a=QueryNode.findChildByUri(t.childNodes[i],e);if(null!=a)return a}return null}hasFacetSetting(t,e){for(var i in this.facetSettings[t]){if(this.facetSettings[t][i].value==e)return!0}return!1}createFullFacetSettings(){var t={};for(var e in this.facetSettings)t[e]=JSON.parse(JSON.stringify(this.facetSettings[e]));for(var i=this.parent;null!=i;){for(var e in i.facetSettings)for(var a in null==t[e]&&(t[e]=[]),i.facetSettings[e]){var o=i.facetSettings[e][a];this.hasFacetSetting(e,o.value)||t[e].push(JSON.parse(JSON.stringify(o)))}i=i.parent}return t}static serialize(t){QueryNode.clearParents(t);var e=JSON.stringify(t);return QueryNode.assignParents(t),e}static addChild(t,e){t.childNodes.push(e),e.parent=t}static mergeAddChild(t,e){var i=QueryNode.findChildByUri(t,e.uri);if(null==i)return QueryNode.addChild(t,e),!0;if(0==e.childNodes.length)return!1;for(var a in e.childNodes)QueryNode.mergeAddChild(i,e.childNodes[a])}static clearParents(t){t.parent=null;for(var e=0;e<t.childNodes.length;e++)QueryNode.clearParents(t.childNodes[e])}static assignParents(t){for(var e=0;e<t.childNodes.length;e++)t.childNodes[e].parent=t,QueryNode.assignParents(t.childNodes[e])}static expandAll(t){t.expanded=!0;for(var e=0;e<t.childNodes.length;e++)QueryNode.expandAll(t.childNodes[e])}static createFrom(t){var e=new QueryNode(t.uri,t.property);return e.childNodes=t.childNodes,e.facetSettings=t.facetSettings,e.parent=t.parent,e.files=t.files,e}static createSubTree(t){var e=QueryNode.createFrom(t);return e.facetSettings=e.createFullFacetSettings(),e.parent=null,e}static findFacetSetting(t,e,i){if(null!=t&&null!=t.facetSettings){var a=t.facetSettings[e];if(null!=a)for(var o in a){var n=a[o];if(n.value==i)return n}}}static findInheritedSetting(t,e,i){if(null!=t){var a=QueryNode.findFacetSetting(t,e,i);return null==a?QueryNode.findInheritedSetting(t.parent,e,i):a}}}"object"==typeof module&&module&&module.exports&&(module.exports=QueryNode);class QueryTemplates{static DEFAULT_PREFIXES=["PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>","PREFIX dcv: <http://dataid.dbpedia.org/ns/cv#>","PREFIX dct:    <http://purl.org/dc/terms/>","PREFIX dcat:   <http://www.w3.org/ns/dcat#>","PREFIX rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#>","PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>"];static COLLECTION_STATISTICS_TEMPLATE={indent:1,prefixes:QueryTemplates.DEFAULT_PREFIXES,select:"SELECT DISTINCT ?dataset ?file ?license ?size WHERE",body:["GRAPH ?g","{","%QUERY%","\t?dataset dcat:distribution ?distribution .","\t?distribution dataid:file ?file .","\tOPTIONAL { ?dataset dct:license ?license . }","\tOPTIONAL { ?distribution dcat:byteSize ?size . }","}"]};static COLLECTION_FILES_TEMPLATE={prefixes:QueryTemplates.DEFAULT_PREFIXES,indent:1,select:"SELECT DISTINCT ?version ?dataset ?distribution ?title ?description (GROUP_CONCAT(DISTINCT ?file; SEPARATOR=\", \") AS ?files) ?license ?size ?format (GROUP_CONCAT(DISTINCT ?var; SEPARATOR=', ') AS ?variant) ?preview WHERE",body:["GRAPH ?g","{","%QUERY%","\t?distribution dataid:file ?file .","\t?distribution dataid:formatExtension ?format .","\tOPTIONAL { ?distribution ?p  ?var. ?p rdfs:subPropertyOf dataid:contentVariant . }","\tOPTIONAL { ?dataset dct:license ?license . }","\tOPTIONAL { ?distribution dcat:byteSize ?size . }","\tOPTIONAL { ?distribution dataid:preview ?preview . }","\t?dataset dcat:distribution ?distribution .","\t?dataset dct:hasVersion ?version .","\t?dataset dct:title ?title .","\t?dataset dct:description ?description.","}"],aggregate:"GROUP BY ?version ?dataset ?distribution ?title ?description ?license ?size ?format ?preview"};static GROUP_PAGE_FILE_BROWSER_TEMPLATE={prefixes:QueryTemplates.DEFAULT_PREFIXES,indent:1,select:"SELECT DISTINCT ?file ?version ?artifact ?license ?size ?format ?compression (GROUP_CONCAT(DISTINCT ?var; SEPARATOR=', ') AS ?variant) ?preview WHERE",body:["GRAPH ?g","{","%QUERY%","\t?dataset dcat:distribution ?distribution .","\t?distribution dataid:file ?file .","\t?distribution dataid:formatExtension ?format .","\t?distribution dataid:compression ?compression .","\t?dataset dct:license ?license .","\t?dataset dct:hasVersion ?version .","\t?dataset dataid:artifact ?artifact .","\tOPTIONAL { ?distribution ?p ?var. ?p rdfs:subPropertyOf dataid:contentVariant . }","\tOPTIONAL { ?distribution dcat:byteSize ?size . }","\tOPTIONAL { ?distribution dataid:preview ?preview . }","}"],aggregate:"GROUP BY ?file ?version ?artifact ?license ?size ?format ?compression ?preview"};static NODE_FILE_TEMPLATE={prefixes:QueryTemplates.DEFAULT_PREFIXES,indent:1,select:"SELECT DISTINCT ?file ?license ?size ?format ?compression (GROUP_CONCAT(DISTINCT ?var; SEPARATOR=', ') AS ?variant) ?preview WHERE",body:["GRAPH ?g","{","%QUERY%","\t?dataset dcat:distribution ?distribution .","\t?distribution dataid:file ?file .","\t?distribution dataid:formatExtension ?format .","\t?distribution dataid:compression ?compression .","\t?dataset dct:license ?license .","\tOPTIONAL { ?distribution ?p ?var. ?p rdfs:subPropertyOf dataid:contentVariant . }","\tOPTIONAL { ?distribution dcat:byteSize ?size . }","\tOPTIONAL { ?distribution dataid:preview ?preview . }","}"],aggregate:"GROUP BY ?file ?license ?size ?format ?compression ?preview"};static DEFAULT_FILE_TEMPLATE={prefixes:QueryTemplates.DEFAULT_PREFIXES,indent:1,select:"SELECT ?file WHERE",body:["GRAPH ?g","{","%QUERY%","\t?dataset dcat:distribution ?distribution .","\t?distribution dataid:file ?file .","}"]};static CUSTOM_QUERY_FILE_TEMPLATE={prefixes:QueryTemplates.DEFAULT_PREFIXES,indent:1,select:"SELECT ?file WHERE",body:["{","%QUERY%","}"]}}"object"==typeof module&&module&&module.exports&&(module.exports=QueryTemplates);const FACET_DEFAULT_SUBQUERY="\n\t{ \n\t\t?distribution <%FACET%> '%VALUE%'^^<http://www.w3.org/2001/XMLSchema#string> . \n\t} ",FACET_DEFAULT_SUBQUERY_PLACEHOLDER_FACET="%FACET%",FACET_DEFAULT_SUBQUERY_PLACEHOLDER_VALUE="%VALUE%",FACET_VERSION_KEY="http://purl.org/dc/terms/hasVersion",FACET_LATEST_VERSION_VALUE="$latest",FACET_LATEST_VERSION_LABEL="Latest Version",FACET_LASTEST_ARTIFACT_VERSION_SUBQUERY="\n\t{\n\t\t?distribution dct:hasVersion ?latestVersion \n\t\t{\n\t\t\tSELECT (?version as ?latestVersion) WHERE { \n\t\t\t\t?dataset dataid:artifact <%ARTIFACT_URI%> . \n\t\t\t\t?dataset dct:hasVersion ?version . \n\t\t\t} ORDER BY DESC (?version) LIMIT 1 \n\t\t} \n\t}",FACET_LASTEST_GROUP_VERSION_SUBQUERY="\n\t{\n\t\t?distribution dct:hasVersion ?latestVersion \n\t\t{\n\t\t\tSELECT (?version as ?latestVersion) WHERE { \n\t\t\t\t?dataset dataid:group <%ARTIFACT_URI%> . \n\t\t\t\t?dataset dct:hasVersion ?version . \n\t\t\t} ORDER BY DESC (?version) LIMIT 1 \n\t\t} \n\t}",FACET_SUBQUERY_UNION="\n\tUNION",DATABUS_SPARQL_ENDPOINT_URL="/sparql";class DatabusFacetsCache{constructor(t){this._facets={},this._http=t,this._regex=new RegExp("%RESOURCE_URI%","g"),this.pathLengthToQueryMap={2:DatabusFacetsCache.GET_GROUP_FACETS,3:DatabusFacetsCache.GET_ARTIFACT_FACETS},this._facetMetadata={"http://purl.org/dc/terms/hasVersion":"Version","http://dataid.dbpedia.org/ns/core#formatExtension":"Format","http://dataid.dbpedia.org/ns/cv#lang":"Language","http://dataid.dbpedia.org/ns/cv#domain":"Domain","http://dataid.dbpedia.org/ns/cv#tag":"Tag","http://dataid.dbpedia.org/ns/core#compression":"Compression"}}async get(t){if(null!=this._facets[t])return{uri:t,facets:this._facets[t]};var e=new URL(t).origin,i=DatabusUtils.getResourcePathLength(t),a=this.pathLengthToQueryMap[i];if(null==a)return null;a=a.replace(this._regex,t);var o={method:"POST",url:`${e}/sparql?query=`,data:`format=json&query=${encodeURIComponent(a)}`,headers:{"Content-type":"application/x-www-form-urlencoded"}},n=await this._http(o),r={};for(var s of n.data.results.bindings){var l=s.property.value;if(null==r[l]){r[l]={};var c=null!=this._facetMetadata[l]?this._facetMetadata[l]:DatabusUtils.uriToName(l);r[s.property.value].label=c,r[s.property.value].values=[]}r[s.property.value].values.push(s.value.value)}return this._facets[t]=r,{uri:t,facets:this._facets[t]}}static GET_GROUP_FACETS="\n  PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\n  PREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\n  PREFIX dct: <http://purl.org/dc/terms/>\n  PREFIX dcat:  <http://www.w3.org/ns/dcat#>\n  PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>\n  \n  SELECT DISTINCT ?property ?value WHERE {\n    {\n      GRAPH ?g {\n        ?dataset dataid:group <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution dct:hasVersion ?value .\n        BIND(dct:hasVersion AS ?property)\n      }\n    }\n    UNION\n    {\n      GRAPH ?g {\n        ?dataset dataid:group <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution dataid:formatExtension ?value .\n        BIND(dataid:formatExtension AS ?property)\n      }\n    }\n    UNION\n    {\n      GRAPH ?g {\n        ?dataset dataid:group <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution dataid:compression ?value .\n        BIND(dataid:compression AS ?property)\n      }\n    }\n    UNION\n    {\n      GRAPH ?g {\n        ?dataset dataid:group <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution ?property ?value .\n        ?property rdfs:subPropertyOf dataid:contentVariant .\n      }\n    }\n  }\n  ";static GET_ARTIFACT_FACETS="\n  PREFIX dataid: <http://dataid.dbpedia.org/ns/core#>\n  PREFIX dataid-cv: <http://dataid.dbpedia.org/ns/cv#>\n  PREFIX dct: <http://purl.org/dc/terms/>\n  PREFIX dcat:  <http://www.w3.org/ns/dcat#>\n  PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>\n  \n  SELECT DISTINCT ?property ?value WHERE {\n    GRAPH ?g {\n    {\n        BIND(dct:hasVersion AS ?property)\n        ?dataset dataid:artifact <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution dct:hasVersion ?value .\n    }\n    UNION\n    {\n        BIND(dataid:formatExtension AS ?property)\n        ?dataset dataid:artifact <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution dataid:formatExtension ?value .\n    }\n    UNION\n    {\n        BIND(dataid:compression AS ?property)\n        ?dataset dataid:artifact <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution dataid:compression ?value .\n    }\n    UNION\n    {\n        ?dataset dataid:artifact <%RESOURCE_URI%> .\n        ?dataset dcat:distribution ?distribution . \n        ?distribution ?property ?value .\n        ?property rdfs:subPropertyOf dataid:contentVariant .\n      }\n    }\n  }"}var DatabusResponse={COLLECTION_CREATED:2e3,COLLECTION_UPDATED:2001,COLLECTION_PUBLISHED:2002,COLLECTION_UNPUBLISHED:2003,COLLECTION_DELETED:2004,COLLECTION_DRAFT_CREATED:2006,COLLECTION_QUERY_COPIED_TO_CLIPBOARD:2007,COLLECTION_LOCAL_CHANGES_DISCARDED:2008,COLLECTION_DOWNLOAD_URLS_COPIED_TO_CLIPBOARD:2009,COLLECTION_BASH_COPIED_TO_CLIPBOARD:2010,COLLECTION_IMPORTED:2011,COLLECTION_INVALID_ID:4e3,COLLECTION_UPDATE_ERROR:4001,COLLECTION_BAD_REQUEST:4002,COLLECTION_MISSING_LABEL:4010,COLLECTION_INVALID_LABEL:4011,COLLECTION_MISSING_DESCRIPTION:4014,COLLECTION_INVALID_DESCRIPTION:4015,COLLECTION_IMPORTED_FAILED:4016,ACCOUNT_ALREADY_EXISTS:4030,ACCOUNT_ACCESS_DENIED:4031,ACCOUNT_INVALID_PERSON_IDENTIFIER:4032,ACCOUNT_PERSON_GRAPH_MISSING:4033,Message:{2e3:"A new collection has been created.",2001:"Your collection has been saved remotely.",2002:"Your collection is now visible.",2003:"Your collection is now hidden.",2004:"Collection deleted.",2006:"A new draft has been created",2007:"The collection query has been copied to the clipboard",2008:"Your local changes have been discarded.",2009:"The collection download URLs have been copied to the clipboard",2010:"The download script has been copied to the clipboard",2011:"Collection imported successfully.",4e3:"Invalid collection id. Please use only lower case letters, numbers, underscores or dashes.",4001:"Saving the collection failed. Please try again later.",4002:"Failed to create the requested identifiers.",4010:"The label field is required.",4011:"Please enter at most 200 characters. The label should not contain any special characters except '(' and ')'.",4013:"Please enter at least 50 and at most 500 characters.",4014:"The description field is required",4015:"Please enter at least 50 characters.",4030:"An account with this name already exists",4031:"You are not allowed to do that.",4032:"The specified person identifier does not match the account",4033:"No graph with person data found.",4016:"Collection JSON import failed."}};"object"==typeof module&&module&&module.exports&&(module.exports=DatabusResponse);class DatabusUris{static JSONLD_TYPE="@type";static JSONLD_ID="@id";static JSONLD_VALUE="@value";static JSONLD_LANGUAGE="@language";static JSONLD_CONTEXT="@context";static JSONLD_GRAPH="@graph";static DATAID_DATASET="http://dataid.dbpedia.org/ns/core#Dataset";static DATAID_PART="http://dataid.dbpedia.org/ns/core#Part";static DATAID_VERSION="http://dataid.dbpedia.org/ns/core#Version";static DATAID_GROUP="http://dataid.dbpedia.org/ns/core#Group";static DATAID_ARTIFACT="http://dataid.dbpedia.org/ns/core#Artifact";static DATAID_VERSION_PROPERTY="http://dataid.dbpedia.org/ns/core#version";static DATAID_GROUP_PROPERTY="http://dataid.dbpedia.org/ns/core#group";static DATAID_ARTIFACT_PROPERTY="http://dataid.dbpedia.org/ns/core#artifact";static DATAID_FORMAT="http://dataid.dbpedia.org/ns/core#format";static DATAID_FORMAT_EXTENSION="http://dataid.dbpedia.org/ns/core#formatExtension";static DATAID_CONTENT_VARIANT="http://dataid.dbpedia.org/ns/core#contentVariant";static DATAID_CONTENT_VARIANT_PREFIX="http://dataid.dbpedia.org/ns/cv#";static DATAID_SHASUM="http://dataid.dbpedia.org/ns/core#sha256sum";static DATAID_COLLECTION="http://dataid.dbpedia.org/ns/core#Collection";static DATAID_FILE="http://dataid.dbpedia.org/ns/core#file";static DATAID_COMPRESSION="http://dataid.dbpedia.org/ns/core#compression";static DATAID_ATTRIBUTION="http://dataid.dbpedia.org/ns/core#attribution";static DCT_PUBLISHER="http://purl.org/dc/terms/publisher";static DCT_HAS_VERSION="http://purl.org/dc/terms/hasVersion";static DCT_ISSUED="http://purl.org/dc/terms/issued";static DCT_CREATED="http://purl.org/dc/terms/created";static DCT_MODIFIED="http://purl.org/dc/terms/modified";static DCT_DISTRIBUTION="http://purl.org/dc/terms/distribution";static DCT_SUBJECT="http://purl.org/dc/terms/subject";static DCT_CREATOR="http://purl.org/dc/terms/creator";static DCT_TITLE="http://purl.org/dc/terms/title";static DCT_ABSTRACT="http://purl.org/dc/terms/abstract";static DCT_DESCRIPTION="http://purl.org/dc/terms/description";static DCT_LICENSE="http://purl.org/dc/terms/license";static DCAT_DOWNLOAD_URL="http://www.w3.org/ns/dcat#downloadURL";static DCAT_BYTESIZE="http://www.w3.org/ns/dcat#byteSize";static DCAT_DISTRIBUTION="http://www.w3.org/ns/dcat#distribution";static SEC_PROOF="https://w3id.org/security#proof";static SEC_SIGNATURE="https://w3id.org/security#signature";static DATABUS_TRACTATE_V1="http://dataid.dbpedia.org/ns/core#DatabusTractateV1";static RDF_PROPERTY="http://www.w3.org/1999/02/22-rdf-syntax-ns#Property";static RDFS_SUB_PROPERTY_OF="http://www.w3.org/2000/01/rdf-schema#subPropertyOf";static XSD_DATE_TIME="http://www.w3.org/2001/XMLSchema#dateTime";static XSD_DECIMAL="http://www.w3.org/2001/XMLSchema#decimal";static XSD_STRING="http://www.w3.org/2001/XMLSchema#string";static SHACL_VALIDATION_REPORT="http://www.w3.org/ns/shacl#ValidationReport";static SHACL_VALIDATION_RESULT="http://www.w3.org/ns/shacl#ValidationResult";static SHACL_CONFORMS="http://www.w3.org/ns/shacl#conforms";static SHACL_RESULT_MESSAGE="http://www.w3.org/ns/shacl#resultMessage";static FOAF_PERSONAL_PROFILE_DOCUMENT="http://xmlns.com/foaf/0.1/PersonalProfileDocument";static S4AC_ACCESS_POLICY="http://ns.inria.fr/s4ac/v2#AccessPolicy";static S4AC_ACCESS_CREATE="http://ns.inria.fr/s4ac/v2#Create";static S4AC_HAS_ACCESS_PRIVILEGE="http://ns.inria.fr/s4ac/v2#hasAccessPrivilege";static CERT_KEY="http://www.w3.org/ns/auth/cert#key";static CERT_MODULUS="http://www.w3.org/ns/auth/cert#modulus";static CERT_EXPONENT="http://www.w3.org/ns/auth/cert#exponent";static PROV_WAS_DERIVED_FROM="http://www.w3.org/ns/prov-o#wasDerivedFrom"}"object"==typeof module&&module&&module.exports&&(module.exports=DatabusUris);var JsonldUris=void 0;JsonldUris="object"==typeof module&&module&&module.exports?require("./databus-uris"):DatabusUris;class DatabusUtils{static stringOrFallback(t,e){return null!=t&&t.length>0?t:e}static isValidResourceIdentifier(t,e){return this.checkField(t,/^[a-z-]+$/,e,50)}static isValidVersionIdentifier(t){return this.checkField(t,/^[A-Za-z0-9_\.\-]*$/,3,50)}static isValidResourceText(t,e,i){return this.checkField(t,/^[\x00-\x7F\n]*$/,e,i)}static isValidAccountName(t){return this.checkField(t,/^[a-z][0-9a-z_\-]+[a-z]$/,3,15)}static isValidGroupName(t){return this.checkField(t,/[a-zA-Z0-9_\-\.]{3,50}$/,3,50)}static isValidArtifactName(t){return this.checkField(t,/[a-zA-Z0-9_\-\.]{3,50}$/,3,50)}static isValidUrl(t){return/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g.test(t)}static isValidResourceLabel(t,e,i){return this.checkField(t,/^[A-Za-z0-9\s_()\.\,\-]*$/,e,i)}static objSize(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i}static uniqueList(t){for(var e={},i=[],a=0,o=t.length;a<o;++a)e.hasOwnProperty(t[a])||(i.push(t[a]),e[t[a]]=1);return i}static formatFileSize(t){return null==t?"0 KB":t<1024?t+" B":t<1048576?Math.round(t/1024)+" KB":t<1073741824?Math.round(10*t/1048576)/10+" MB":Math.round(100*t/1073741824)/100+" GB"}static checkField(t,e,i,a){return null!=t&&(!(a>0&&t.length>a)&&(!(t.length<i)&&e.test(t)))}static uuidv4(){return"___xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}static tryParseJson(t){return JSON.parse(t)}static uriToTitle(t){if(null==t)return null;var e=t.substr(t.lastIndexOf("/")+1);return(e=e.substr(e.lastIndexOf("#")+1)).charAt(0).toUpperCase()+e.slice(1)}static uriToName(t){if(null==t)return null;var e=t.substr(t.lastIndexOf("/")+1);return(e=e.substr(e.lastIndexOf("#")+1)).includes(".")&&(e=e.substr(0,e.lastIndexOf("."))),e}static isValidHttpUrl(t){let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}static navigateUp(t,e){null==e&&(e=1);for(var i=0;i<e;i++)t=t.substr(0,t.lastIndexOf("/"));return t.includes("#")&&(t=t.substr(0,t.lastIndexOf("#"))),t}static copyStringToClipboard(t){var e=document.createElement("textarea");e.value=t,e.setAttribute("readonly",""),e.style={position:"absolute",left:"-9999px"},document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}static serialize(t,e){return null==e&&(e=["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published"]),JSON.stringify(t,(function(t,i){if(!e.includes(t))return i}))}static createCleanCopy(t){return JSON.parse(DatabusCollectionUtils.serialize(t))}static lineCount(t){return(t.match(/^\s*\S/gm)||"").length}static getResourcePathLength(t){var e=DatabusUtils.splitResourceUri(t);return 1==e.length&&""==e[0]?0:e.length}static splitResourceUri(t){return(t=new URL(t).pathname).startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.split("/")}static exportToJsonFile(t){let e=DatabusCollectionUtils.serialize(t,["parent","$$hashKey","expanded","files","eventListeners","hasLocalChanges","published","uuid"]),i="data:application/json;charset=utf-8,"+encodeURIComponent(e),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download","data.json"),a.click()}static async parseN3(t,e){return new Promise(((i,a)=>{const o=[],n=[];(new N3.Parser).parse(t,((t,r,s)=>{t?a(t):((o.length>e||null==r)&&i({quads:o,prefixes:n}),r&&o.push(r))}))}))}static async parseDatabusManifest(t){var e=await DatabusUtils.parseN3(t,100);for(var i of e.quads)if("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==i.predicate.id&&"http://dataid.dbpedia.org/ns/core#Databus"==i.object.id)return{uri:i.subject.id}}static createAbstractFromDescription(t){try{for(var e=("object"==typeof module&&module&&module.exports?require("markdown-it")():window.markdownit()).parse(t),i="",a=0;a<e.length;a++){var o=e[a];if("inline"==o.type&&"paragraph_open"==e[a-1].type&&1==o.level){i=o.content;break}}return i}catch(t){return void console.log(t)}}static cvSplit(t,e,i){var a=[];if(t.length<=1)return a;if(i>=e.length){if(t.length>1){var o={downloadURLs:[]};for(var n of t)o.downloadURLs.push(n[JsonldUris.DCAT_DOWNLOAD_URL][0][JsonldUris.JSONLD_ID]);for(var r of(o[JsonldUris.DATAID_FORMAT_EXTENSION]=t[0][JsonldUris.DATAID_FORMAT_EXTENSION][0][JsonldUris.JSONLD_VALUE],o[JsonldUris.DATAID_COMPRESSION]=t[0][JsonldUris.DATAID_COMPRESSION][0][JsonldUris.JSONLD_VALUE],e))o[r]=null!=t[0][r]?t[0][r][0][JsonldUris.JSONLD_VALUE]:"none";a.push(o)}}else{r=e[i];var s={};for(var n of t){var l=n[r];null!=l&&(l=l[0]["@value"]),null!=l&&""!=l||(l="$_none$"),null==s[l]&&(s[l]=[]),s[l].push(n)}for(var c in s)for(var o of DatabusUtils.cvSplit(s[c],e,i+1,a))a.push(o)}return a}}"object"==typeof module&&module&&module.exports&&(module.exports=DatabusUtils);const JSONLD_CONTEXT={dataid:"http://dataid.dbpedia.org/ns/core#",databus:"https://databus.dbpedia.org/system/ontology#","dataid-cv":"http://dataid.dbpedia.org/ns/cv#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",dct:"http://purl.org/dc/terms/",dcat:"http://www.w3.org/ns/dcat#",xsd:"http://www.w3.org/2001/XMLSchema#",cert:"http://www.w3.org/ns/auth/cert#",dbo:"http://dbpedia.org/ontology/",foaf:"http://xmlns.com/foaf/0.1/",sec:"https://w3id.org/security#",maker:{"@id":"foaf:maker","@type":"@id"},primaryTopic:{"@id":"foaf:primaryTopic","@type":"@id"},name:{"@id":"foaf:name","@type":"xsd:string"},account:{"@id":"foaf:account","@type":"@id"},img:{"@id":"foaf:img","@type":"@id"},key:{"@id":"cert:key"},modulus:{"@id":"cert:modulus"},exponent:{"@id":"cert:exponent"},title:{"@id":"dct:title","@type":"xsd:string"},label:{"@id":"rdfs:label","@type":"xsd:string"},comment:{"@id":"rdfs:comment","@type":"xsd:string"},abstract:{"@id":"dct:abstract","@type":"xsd:string"},description:{"@id":"dct:description","@type":"xsd:string"},issued:{"@id":"dct:issued","@type":"xsd:dateTime"},modified:{"@id":"dct:modified","@type":"xsd:dateTime"},license:{"@id":"dct:license","@type":"@id"},publisher:{"@id":"dct:publisher","@type":"@id"},distribution:{"@id":"dcat:distribution","@type":"@id"},downloadURL:{"@id":"dcat:downloadURL","@type":"@id"},file:{"@id":"dataid:file","@type":"@id"},byteSize:{"@id":"dcat:byteSize","@type":"xsd:decimal"},group:{"@id":"dataid:group","@type":"@id"},Group:"dataid:Group",Dataset:"dataid:Dataset",Artifact:"dataid:Artifact",artifact:{"@id":"dataid:artifact","@type":"@id"},version:{"@id":"dataid:version","@type":"@id"},hasVersion:{"@id":"dct:hasVersion","@type":"xsd:string"},formatExtension:{"@id":"dataid:formatExtension","@type":"xsd:string"},format:{"@id":"dataid:formatExtension","@type":"xsd:string"},compression:{"@id":"dataid:compression","@type":"xsd:string"},sha256sum:{"@id":"dataid:sha256sum","@type":"xsd:string"},signature:{"@id":"dataid:signature","@type":"xsd:string"},tractate:{"@id":"databus:tractate","@type":"xsd:string"}};JsonldUris=void 0;JsonldUris="object"==typeof module&&module&&module.exports?require("./databus-uris"):DatabusUris;class JsonldUtils{static getTypedGraph(t,e){for(var i in t){var a=t[i];if(null!=a[JsonldUris.JSONLD_TYPE]&&a[JsonldUris.JSONLD_TYPE].includes(e))return a}return null}static setLiteral(t,e,i,a){t[e]=[];var o={};o[JsonldUris.JSONLD_TYPE]=i,o[JsonldUris.JSONLD_VALUE]=a,t[e].push(o)}static setLink(t,e,i){t[e]=[];var a={};a[JsonldUris.JSONLD_ID]=i,t[e].push(a)}static getProperty(t,e){if(null==t[e])return null;if(1==t[e].length)return null!=(a=t[e][0])[JsonldUris.JSONLD_VALUE]?a[JsonldUris.JSONLD_VALUE]:null!=a[JsonldUris.JSONLD_ID]?a[JsonldUris.JSONLD_ID]:null;var i=[];for(var a of t[e])null!=a[JsonldUris.JSONLD_VALUE]&&i.push(a[JsonldUris.JSONLD_VALUE]),null!=a[JsonldUris.JSONLD_ID]&&i.push(a[JsonldUris.JSONLD_ID]);return i.length>0?i:null}static getGraphById(t,e){for(var i in t){var a=t[i];if(null!=a[JsonldUris.JSONLD_ID]&&a[JsonldUris.JSONLD_ID]==e)return a}return null}static getTypedGraphs(t,e){var i=[];for(var a in t){var o=t[a];null!=o[JsonldUris.JSONLD_TYPE]&&o[JsonldUris.JSONLD_TYPE].includes(e)&&i.push(o)}return i}static getSubPropertyGraphs(t,e){var i=[];for(var a of t)if(null!=a[JsonldUris.RDFS_SUB_PROPERTY_OF])for(var o of a[JsonldUris.RDFS_SUB_PROPERTY_OF])o[JsonldUris.JSONLD_ID]==e&&i.push(a);return i}static getFirstObject(t,e){var i=t[e];return null==i||i.length<1?null:i[0]}static getFirstObjectUri(t,e){var i=t[e];return null==i||i.length<1?null:i[0][JsonldUris.JSONLD_ID]}}"object"==typeof module&&module&&module.exports&&(module.exports=JsonldUtils),function(t){"use strict";var e=function(t){if("string"!=typeof t)return 0;var e=t.match(/\d/g);return e?Math.min.apply(null,e):1},i=function(t){var i,a,o=t.selector,n=t.scope,r=document.createElement("ol"),s=r,l=null,c=(i=t.overwrite,a=t.prefix,function(t,e,o){var n=t.textContent,r=a+"-"+o;e.textContent=n;var s=i?r:t.id||r;s=encodeURIComponent(s),t.id=s,e.href="#"+s});return function(t,e){var i=[],a=document.querySelectorAll(e);return Array.prototype.forEach.call(a,(function(e){var a=e.querySelectorAll(t);i=i.concat(Array.prototype.slice.call(a))})),i}(o,n).reduce((function(t,i,a){var o=e(i.tagName),n=o-t;n>0&&(s=function(t,e){for(;e--;)t=t.appendChild(document.createElement("ol")),e&&(t=t.appendChild(document.createElement("li")));return t}(l,n)),n<0&&(s=function(t,e){for(;e--;)t=t.parentElement;return t}(s,2*-n)),s=s||r;var u=document.createElement("li"),d=document.createElement("a");return c(i,d,a),s.appendChild(u).appendChild(d),l=u,o}),e(o)),r},a=function(t){var e=(t=function(t,e){for(var i in e)e.hasOwnProperty(i)&&e[i]&&(t[i]=e[i]);return t}({selector:"h1, h2, h3, h4, h5, h6",scope:"body",overwrite:!1,prefix:"toc"},t)).selector;if("string"!=typeof e)throw new TypeError("selector must be a string");if(!e.match(/^(?:h[1-6],?\s*)+$/g))throw new TypeError("selector must contains only h1-6");var a=location.hash;return a&&setTimeout((function(){var t=document.getElementById(a.slice(1));t&&t.scrollIntoView()}),0),i(t)};"function"==typeof define&&define.amd?define((function(){return a})):t.initTOC=a}(window);